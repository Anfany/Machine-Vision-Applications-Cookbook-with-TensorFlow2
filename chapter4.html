
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>4 训练目标检测模型 · Machine Vision CookBook with TensorFlow2</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="AnFany">
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-donate/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-chapter-fold/chapter-fold.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-auto-scroll-table/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-pageview-count/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="chapter4.html" />
    
    
    <link rel="prev" href="chapter3.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./#tensorflow2-object-detection-api-全流程文档">
            
                    
                    序
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="./">
            
                <a href="./#序：无关编码">
            
                    
                    序：无关编码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2" data-path="./">
            
                <a href="./#扫码关注">
            
                    
                    扫码关注
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.3" data-path="./">
            
                <a href="./#联系作者">
            
                    
                    联系作者
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="chapter1.html">
            
                <a href="chapter1.html#1-win10系统tensorflow-gpu22安装">
            
                    
                    1 Win10系统安装TensorFlow-gpu2.2
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="chapter1.html">
            
                <a href="chapter1.html#11-显卡驱动">
            
                    
                    1.1  显卡驱动
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="chapter1.html">
            
                <a href="chapter1.html#111-选择版本">
            
                    
                    1.1.1 选择版本
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" data-path="chapter1.html">
            
                <a href="chapter1.html#112-安装">
            
                    
                    1.1.2 安装
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="chapter1.html">
            
                <a href="chapter1.html#12-cuda工具包">
            
                    
                    1.2 CUDA工具包
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="chapter1.html">
            
                <a href="chapter1.html#121-选择版本">
            
                    
                    1.2.1 选择版本
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="chapter1.html">
            
                <a href="chapter1.html#122-自定义安装">
            
                    
                    1.2.2 自定义安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.3" data-path="chapter1.html">
            
                <a href="chapter1.html#123-添加环境变量">
            
                    
                    1.2.3 添加环境变量
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.4" data-path="chapter1.html">
            
                <a href="chapter1.html#124-验证安装">
            
                    
                    1.2.4 验证安装
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="chapter1.html">
            
                <a href="chapter1.html#13-cudnn">
            
                    
                    1.3 cuDNN
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.1" data-path="chapter1.html">
            
                <a href="chapter1.html#131-选择版本">
            
                    
                    1.3.1 选择版本
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.2" data-path="chapter1.html">
            
                <a href="chapter1.html#132-移动文件">
            
                    
                    1.3.2 移动文件
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="chapter1.html">
            
                <a href="chapter1.html#14-安装anaconda">
            
                    
                    1.4 安装Anaconda
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.4.1" data-path="chapter1.html">
            
                <a href="chapter1.html#141-下载">
            
                    
                    1.4.1 下载
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.2" data-path="chapter1.html">
            
                <a href="chapter1.html#142-验证安装">
            
                    
                    1.4.2 验证安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.3" data-path="chapter1.html">
            
                <a href="chapter1.html#143-conda创建虚拟环境">
            
                    
                    1.4.3 conda创建虚拟环境
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.4" data-path="chapter1.html">
            
                <a href="chapter1.html#144-激活虚拟环境">
            
                    
                    1.4.4 激活虚拟环境
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="chapter1.html">
            
                <a href="chapter1.html#15-运行方式">
            
                    
                    1.5 运行方式
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.5.1" data-path="chapter1.html">
            
                <a href="chapter1.html#151-jupyter-notebook">
            
                    
                    1.5.1 Jupyter Notebook
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.5.1.1" >
            
                <span>
            
                    
                    1.5.1.1 建立python3.8虚拟环境
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.1.2" >
            
                <span>
            
                    
                    1.5.1.2 安装tensorflow-gpu 2.2 版本
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.1.3" >
            
                <span>
            
                    
                    1.5.1.3 安装ipython
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.1.4" >
            
                <span>
            
                    
                    1.5.1.4 安装jupyter notebook
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.1.5" >
            
                <span>
            
                    
                    1.5.1.5 安装ipykernel
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.1.6" >
            
                <span>
            
                    
                    1.5.1.6 更改文件路径
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.1.7" >
            
                <span>
            
                    
                    1.5.1.7 验证安装
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.5.2" data-path="chapter1.html">
            
                <a href="chapter1.html#152-pycharm">
            
                    
                    1.5.2 PyCharm
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.5.2.1" >
            
                <span>
            
                    
                    1.5.2.1 下载社区版本
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.2.2" >
            
                <span>
            
                    
                    1.5.2.2 设置编译器
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.2.3" >
            
                <span>
            
                    
                    1.5.2.3 验证
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.5.3" data-path="chapter1.html">
            
                <a href="chapter1.html#153-错误问题汇集">
            
                    
                    1.5.3 错误问题汇集
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.5.3.1" >
            
                <span>
            
                    
                    1.5.3.1 出现出现.pywrap_tensorflow_internal import错误
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="chapter2.html">
            
                <a href="chapter2.html#2-搭建object-detection环境">
            
                    
                    2 搭建Object Detection环境
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="chapter2.html">
            
                <a href="chapter2.html#21-安装tensorflow模型库">
            
                    
                    2.1 安装TenorFlow模型库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="chapter2.html">
            
                <a href="chapter2.html#22-protobuf安装与编译">
            
                    
                    2.2 Protobuf安装与编译
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="chapter2.html">
            
                <a href="chapter2.html#221-下载protoc">
            
                    
                    2.2.1 下载protoc
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="chapter2.html">
            
                <a href="chapter2.html#222-验证">
            
                    
                    2.2.2 验证
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="chapter2.html">
            
                <a href="chapter2.html#223-编译">
            
                    
                    2.2.3 编译
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="chapter2.html">
            
                <a href="chapter2.html#23-安装coco-api">
            
                    
                    2.3 安装COCO API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.1" data-path="chapter2.html">
            
                <a href="chapter2.html#231-安装cython">
            
                    
                    2.3.1 安装cython
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.2" data-path="chapter2.html">
            
                <a href="chapter2.html#232-下载coco-api压缩包">
            
                    
                    2.3.2 下载coco-api压缩包
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.3" data-path="chapter2.html">
            
                <a href="chapter2.html#233-安装">
            
                    
                    2.3.3 安装
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="chapter2.html">
            
                <a href="chapter2.html#24-安装object-detection-api">
            
                    
                    2.4 安装Object Detection API
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="chapter3.html">
            
                <a href="chapter3.html#3-目标检测模型">
            
                    
                    3 目标检测模型
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="chapter3.html">
            
                <a href="chapter3.html#31-模型下载">
            
                    
                    3.1 模型下载
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1.1" data-path="chapter3.html">
            
                <a href="chapter3.html#311-获取模型信息">
            
                    
                    3.1.1 获取模型信息
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.2" data-path="chapter3.html">
            
                <a href="chapter3.html#312-下载模型">
            
                    
                    3.1.2 下载模型
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="chapter3.html">
            
                <a href="chapter3.html#32-图片目标检测">
            
                    
                    3.2 图片目标检测
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="chapter3.html">
            
                <a href="chapter3.html#33-视频目标检测">
            
                    
                    3.3 视频目标检测
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.3.1" data-path="chapter3.html">
            
                <a href="chapter3.html#331-本地视频">
            
                    
                    3.3.1 本地视频
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.2" data-path="chapter3.html">
            
                <a href="chapter3.html#332-在线视频">
            
                    
                    3.3.2 在线视频
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="chapter4.html">
            
                <a href="chapter4.html#4-训练目标检测模型">
            
                    
                    4 训练目标检测模型
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="chapter4.html">
            
                <a href="chapter4.html#41-文件结构搭建">
            
                    
                    4.1 文件结构搭建
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="chapter4.html">
            
                <a href="chapter4.html#42-准备数据集">
            
                    
                    4.2 准备数据集
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="chapter4.html">
            
                <a href="chapter4.html#421-数据标注">
            
                    
                    4.2.1 数据标注
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.2" data-path="chapter4.html">
            
                <a href="chapter4.html#422-数据集分割">
            
                    
                    4.2.2 数据集分割
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.3" data-path="chapter4.html">
            
                <a href="chapter4.html#423-创建标签映射">
            
                    
                    4.2.3 创建标签映射
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.4" data-path="chapter4.html">
            
                <a href="chapter4.html#424-转xml为record格式">
            
                    
                    4.2.4 转*.xml为*.record
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="chapter4.html">
            
                <a href="chapter4.html#43-构建训练任务">
            
                    
                    4.3 构建训练任务
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.3.1" data-path="chapter4.html">
            
                <a href="chapter4.html#431-获取预训练模型">
            
                    
                    4.3.1 获取预训练模型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.2" data-path="chapter4.html">
            
                <a href="chapter4.html#432-配置训练管道">
            
                    
                    4.3.2 配置训练管道
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.3.2.1" >
            
                <span>
            
                    
                    4.3.2.1 设置检测对象类的格式
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.2.2" >
            
                <span>
            
                    
                    4.3.2.2 修改批训练大小
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.2.3" >
            
                <span>
            
                    
                    4.3.2.3 模型配置
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.2.4" >
            
                <span>
            
                    
                    4.3.2.4 训练数据集
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.2.5" >
            
                <span>
            
                    
                    4.3.2.5 测试数据集
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3.3" data-path="chapter4.html">
            
                <a href="chapter4.html#433-训练模型">
            
                    
                    4.3.3 训练模型
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.3.3.1" >
            
                <span>
            
                    
                    4.3.3.1 No module named 'lvis'
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.3.2" >
            
                <span>
            
                    
                    4.3.3.2 No module named 'official'
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.3.3" >
            
                <span>
            
                    
                    4.3.3.3 No module named 'yaml'
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.3.4" >
            
                <span>
            
                    
                    4.3.3.4 开始训练
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3.4" data-path="chapter4.html">
            
                <a href="chapter4.html#434-训练过程可视化">
            
                    
                    4.3.4 训练过程可视化
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="chapter4.html">
            
                <a href="chapter4.html#44-评估模型">
            
                    
                    4.4 评估模型
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.4.1" data-path="chapter4.html">
            
                <a href="chapter4.html#441-设置评估标准">
            
                    
                    4.4.1 设置评估标准
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.2" data-path="chapter4.html">
            
                <a href="chapter4.html#442-评估">
            
                    
                    4.4.2 评估
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.3" data-path="chapter4.html">
            
                <a href="chapter4.html#443-评估结果查看">
            
                    
                    4.4.3 评估结果查看
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="chapter4.html">
            
                <a href="chapter4.html#45-模型保存">
            
                    
                    4.5 模型保存
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="chapter4.html">
            
                <a href="chapter4.html#46-模型预测">
            
                    
                    4.6 模型预测
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="chapter5.html">
            
                <a href="chapter5.html#5-人脸识别模型">
            
                    
                    5 人脸识别模型
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="chapter5.html">
            
                <a href="chapter5.html#51-mtcnn">
            
                    
                    5.1 MTCNN
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1.1" data-path="chapter5.html">
            
                <a href="chapter5.html#511-人脸检测">
            
                    
                    5.1.1 人脸检测
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.2" data-path="chapter5.html">
            
                <a href="chapter5.html#512-人脸对齐">
            
                    
                    5.1.2 人脸对齐
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="chapter5.html">
            
                <a href="chapter5.html#52-facenet">
            
                    
                    5.2 FaceNet
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.2.1" data-path="chapter5.html">
            
                <a href="chapter5.html#521-下载facenet源码">
            
                    
                    5.2.1 下载FaceNet源码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.2" data-path="chapter5.html">
            
                <a href="chapter5.html#522-下载预训练模型">
            
                    
                    5.2.2 下载预训练模型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.3" data-path="chapter5.html">
            
                <a href="chapter5.html#523-人脸数据库">
            
                    
                    5.2.3 人脸数据库
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.2.3.1" >
            
                <span>
            
                    
                    5.2.3.1 建立人脸数据库
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.3.2" >
            
                <span>
            
                    
                    5.2.3.2 数据库人脸编码
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.2.4" data-path="chapter5.html">
            
                <a href="chapter5.html#524-人脸编码距离">
            
                    
                    5.2.4 人脸编码距离
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.5" data-path="chapter5.html">
            
                <a href="chapter5.html#525-图片人脸识别">
            
                    
                    5.2.5 图片人脸识别
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.6" data-path="chapter5.html">
            
                <a href="chapter5.html#526-视频人脸识别">
            
                    
                    5.2.6 视频人脸识别
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="chapter6.md">
            
                <span>
            
                    
                    6 目标检测知识备忘
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="chapter7.md">
            
                <span>
            
                    
                    7 附录
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >4 训练目标检测模型</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="4-&#x8BAD;&#x7EC3;&#x76EE;&#x6807;&#x68C0;&#x6D4B;&#x6A21;&#x578B;"><a name="4-&#x8BAD;&#x7EC3;&#x76EE;&#x6807;&#x68C0;&#x6D4B;&#x6A21;&#x578B;" class="plugin-anchor" href="#4-&#x8BAD;&#x7EC3;&#x76EE;&#x6807;&#x68C0;&#x6D4B;&#x6A21;&#x578B;"><i class="fa fa-link" aria-hidden="true"></i></a>4 &#x8BAD;&#x7EC3;&#x76EE;&#x6807;&#x68C0;&#x6D4B;&#x6A21;&#x578B;</h1>
<h2 id="41-&#x6587;&#x4EF6;&#x7ED3;&#x6784;&#x642D;&#x5EFA;"><a name="41-&#x6587;&#x4EF6;&#x7ED3;&#x6784;&#x642D;&#x5EFA;" class="plugin-anchor" href="#41-&#x6587;&#x4EF6;&#x7ED3;&#x6784;&#x642D;&#x5EFA;"><i class="fa fa-link" aria-hidden="true"></i></a>4.1 &#x6587;&#x4EF6;&#x7ED3;&#x6784;&#x642D;&#x5EFA;</h2>
<p>&#x5F53;&#x524D;&#x7684;&#x6587;&#x4EF6;&#x5939;&#x7ED3;&#x6784;&#x5E94;&#x8BE5;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A;</p>
<p><img src="figure/4.1.jpg" style="zoom:100%;"></p>
<p>&#x4E0B;&#x9762;&#x9700;&#x8981;&#x5C06;&#x6587;&#x4EF6;&#x7684;&#x6811;&#x7ED3;&#x6784;&#x53D8;&#x4E3A;&#x5982;&#x4E0B;&#x6837;&#x5F0F;&#xFF1A;</p>
<p><img src="figure/4.2.jpg" style="zoom:100%;"></p>
<p>&#x9996;&#x5148;&#x5728;&#x76EE;&#x5F55;&#x4E0B;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;&#x201C;workspace&#x201D;&#x7684;&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x8BE5;&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#x9762;&#x53EF;&#x4EE5;&#x65B0;&#x5EFA;&#x591A;&#x4E2A;&#x9488;&#x5BF9;&#x4E0D;&#x540C;&#x8BAD;&#x7EC3;&#x6570;&#x636E;&#x96C6;&#x7684;&#x8BAD;&#x7EC3;&#x4EFB;&#x52A1;&#xFF0C;&#x4F8B;&#x5982;training_demo1&#xFF0C;training_demo3&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x7ED9;&#x51FA;&#x5404;&#x4E2A;&#x6587;&#x4EF6;&#x5939;&#x7684;&#x8BF4;&#x660E;&#xFF1A;</p>
<ul>
<li><p><strong>annotations</strong>&#xFF1A;&#x5B58;&#x50A8;*.csv&#x548C;*.record&#x683C;&#x5F0F;&#x7684;&#x6570;&#x636E;&#x96C6;&#x7684;&#x6807;&#x6CE8;&#x6587;&#x4EF6;&#xFF1B;</p>
</li>
<li><p><strong>exported-models</strong>&#xFF1A;&#x5B58;&#x50A8;&#x6A21;&#x578B;&#x7684;&#x4FDD;&#x5B58;&#x6587;&#x4EF6;&#xFF1B;</p>
</li>
<li><p><strong>Images</strong>&#xFF1A;&#x5B58;&#x50A8;&#x6570;&#x636E;&#x96C6;&#x7684;&#x56FE;&#x7247;&#x4EE5;&#x53CA;&#x6807;&#x6CE8;&#x540E;&#x7684;*.xml&#x6587;&#x4EF6;&#xFF1A;</p>
<ul>
<li><em>Train</em>&#xFF1A;&#x8BAD;&#x7EC3;&#x6570;&#x636E;&#x96C6;&#x7684;&#x56FE;&#x7247;&#x4EE5;&#x53CA;&#x5BF9;&#x5E94;&#x7684;*.xml&#x6587;&#x4EF6;&#xFF1B;</li>
<li><em>Test</em>&#xFF1A;&#x6D4B;&#x8BD5;&#x6570;&#x636E;&#x96C6;&#x7684;&#x56FE;&#x7247;&#x4EE5;&#x53CA;&#x5BF9;&#x5E94;&#x7684;*.xml&#x6587;&#x4EF6;&#xFF1B;</li>
</ul>
</li>
<li><p><strong>models</strong>&#xFF1A;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x5939;&#x5C06;&#x5305;&#x542B;&#x6BCF;&#x4E2A;&#x8BAD;&#x7EC3;&#x4EFB;&#x52A1;&#x7684;&#x5B50;&#x6587;&#x4EF6;&#x5939;&#x3002;&#x6BCF;&#x4E2A;&#x5B50;&#x6587;&#x4EF6;&#x5939;&#x5C06;&#x5305;&#x542B;&#x8BAD;&#x7EC3;&#x7BA1;&#x9053;&#x914D;&#x7F6E;&#x6587;&#x4EF6;*.config&#xFF0C;&#x4EE5;&#x53CA;&#x5728;&#x8BAD;&#x7EC3;&#x548C;&#x8BC4;&#x4F30;&#x6A21;&#x578B;&#x671F;&#x95F4;&#x751F;&#x6210;&#x7684;&#x6240;&#x6709;&#x6587;&#x4EF6;&#x3002;</p>
</li>
<li><strong>pre-trained-models</strong>&#xFF1A;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x5939;&#x5C06;&#x5305;&#x542B;&#x4E0B;&#x8F7D;&#x7684;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;&#xFF0C;&#x8FD9;&#x4E9B;&#x6A21;&#x578B;&#x5C06;&#x4F5C;&#x4E3A;&#x6211;&#x4EEC;&#x8BAD;&#x7EC3;&#x5DE5;&#x4F5C;&#x7684;&#x8D77;&#x59CB;&#x68C0;&#x67E5;&#x70B9;&#x3002;</li>
</ul>
<p>&#x5B9E;&#x73B0;&#x5EFA;&#x7ACB;&#x6587;&#x4EF6;&#x7ED3;&#x6784;&#x7684;python&#x7A0B;&#x5E8F;</p>
<pre><code class="lang-python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment"># author:AnFany</span>
<span class="hljs-comment"># datetime:2020/12/14 16:12</span>

<span class="hljs-comment"># &#x5EFA;&#x7ACB;&#x6587;&#x4EF6;&#x5939;&#x6846;&#x67B6;</span>

MainFolder = <span class="hljs-string">r&apos;E:\odapi_gwt\models\workspace\training_demo_RiverFloatage&apos;</span>

FolderDict = {<span class="hljs-string">&apos;annotations&apos;</span>: <span class="hljs-number">1</span>,
              <span class="hljs-string">&apos;exported-models&apos;</span>: <span class="hljs-number">1</span>,
              <span class="hljs-string">&apos;images&apos;</span>: [<span class="hljs-string">&apos;test&apos;</span>, <span class="hljs-string">&apos;train&apos;</span>],
              <span class="hljs-string">&apos;models&apos;</span>:<span class="hljs-number">1</span>,
              <span class="hljs-string">&apos;pre-trained-models&apos;</span>: <span class="hljs-number">1</span>}

<span class="hljs-keyword">import</span> os

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_folder</span><span class="hljs-params">(mp=MainFolder, fd=FolderDict)</span>:</span>
    <span class="hljs-keyword">for</span> dd <span class="hljs-keyword">in</span> fd:
        alpath = <span class="hljs-string">&apos;%s/%s&apos;</span> % (mp, dd)
        <span class="hljs-keyword">if</span> os.path.exists(alpath):
            print(<span class="hljs-string">&apos;&#x6587;&#x4EF6;&#x5939;%s&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&apos;</span> % dd)
            <span class="hljs-keyword">pass</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">if</span> fd[dd] == <span class="hljs-number">1</span>:
                os.mkdir(alpath)
            <span class="hljs-keyword">else</span>:
                <span class="hljs-keyword">for</span> df <span class="hljs-keyword">in</span> fd[dd]:
                    path = <span class="hljs-string">&apos;%s/%s&apos;</span> % (alpath, df)
                    os.makedirs(path)
    <span class="hljs-keyword">return</span> print(<span class="hljs-string">&apos;&#x521B;&#x5EFA;&#x5B8C;&#x6BD5;&apos;</span>)
build_folder()
</code></pre>
<h2 id="42-&#x51C6;&#x5907;&#x6570;&#x636E;&#x96C6;"><a name="42-&#x51C6;&#x5907;&#x6570;&#x636E;&#x96C6;" class="plugin-anchor" href="#42-&#x51C6;&#x5907;&#x6570;&#x636E;&#x96C6;"><i class="fa fa-link" aria-hidden="true"></i></a>4.2 &#x51C6;&#x5907;&#x6570;&#x636E;&#x96C6;</h2>
<h3 id="421-&#x6570;&#x636E;&#x6807;&#x6CE8;"><a name="421-&#x6570;&#x636E;&#x6807;&#x6CE8;" class="plugin-anchor" href="#421-&#x6570;&#x636E;&#x6807;&#x6CE8;"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.1 &#x6570;&#x636E;&#x6807;&#x6CE8;</h3>
<h4 id="4211-&#x5B89;&#x88C5;labelimg"><a name="4211-&#x5B89;&#x88C5;labelimg" class="plugin-anchor" href="#4211-&#x5B89;&#x88C5;labelimg"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.1.1 &#x5B89;&#x88C5;LabelImg</h4>
<p>pip&#x65B9;&#x5F0F;&#x5B89;&#x88C5;(&#x5EFA;&#x8BAE;)&#xFF0C;&#x6FC0;&#x6D3B;&#x865A;&#x62DF;&#x73AF;&#x5883;&#xFF0C;&#x6267;&#x884C;&#x547D;&#x4EE4;</p>
<p><img src="figure/4.3.jpg" style="zoom:100%;"></p>
<p>&#x6FC0;&#x6D3B;&#x73AF;&#x5883;&#xFF0C;cd&#x8FDB;&#x5165;&#x56FE;&#x7247;&#x5B58;&#x653E;&#x7684;&#x8DEF;&#x5F84;&#xFF0C;&#x7136;&#x540E;&#x8FD0;&#x884C;labelImg&#x5373;&#x53EF;&#x3002;</p>
<h4 id="4212-&#x722C;&#x53D6;&#x767E;&#x5EA6;&#x56FE;&#x7247;"><a name="4212-&#x722C;&#x53D6;&#x767E;&#x5EA6;&#x56FE;&#x7247;" class="plugin-anchor" href="#4212-&#x722C;&#x53D6;&#x767E;&#x5EA6;&#x56FE;&#x7247;"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.1.2 &#x722C;&#x53D6;&#x767E;&#x5EA6;&#x56FE;&#x7247;</h4>
<p>&#x6839;&#x636E;&#x5173;&#x952E;&#x8BCD;&#x722C;&#x53D6;&#x767E;&#x5EA6;&#x56FE;&#x7247;&#xFF0C;&#x53EF;&#x81EA;&#x5B9A;&#x4E49;&#x6570;&#x91CF;&#x3002;python&#x7A0B;&#x5E8F;</p>
<pre><code class="lang-python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment"># author:AnFany</span>
<span class="hljs-comment"># datetime:2020/12/8 15:31</span>

<span class="hljs-comment"># &#x6839;&#x636E;&#x540D;&#x5B57;&#x5229;&#x7528;&#x767E;&#x5EA6;&#x56FE;&#x7247;&#x722C;&#x53D6;&#x7167;&#x7247;</span>
<span class="hljs-keyword">import</span> re
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> requests       <span class="hljs-comment">#&#x5BFC;&#x5165;requests&#x5305;</span>
<span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup

<span class="hljs-comment"># &#x4FDD;&#x5B58;&#x56FE;&#x7247;&#x7684;&#x8DEF;&#x5F84;</span>
FigPath = <span class="hljs-string">r&apos;E:\odapi_gwt\models\workspace\training_demo_james_kobe\images&apos;</span>

HeadUrl = <span class="hljs-string">r&apos;https://image.baidu.com/search/acjson?tn=resultjson_com&apos;</span> \
          <span class="hljs-string">r&apos;&amp;logid=8408718041848823114&amp;ipn=rj&amp;ct=201326592&amp;is=&amp;&apos;</span> \
          <span class="hljs-string">r&apos;fp=result&amp;queryWord={}&amp;cl=2&amp;lm=-1&amp;ie=utf-8&amp;oe=utf-8&apos;</span> \
          <span class="hljs-string">r&apos;&amp;adpicid=&amp;st=-1&amp;z=&amp;ic=0&amp;hd=&amp;latest=&amp;copyright=&amp;word={}&apos;</span>\
          <span class="hljs-string">r&apos;&amp;s=&amp;se=&amp;tab=&amp;width=&amp;height=&amp;face=0&amp;istype=2&amp;qc=&amp;nc=1&amp;&apos;</span> \
          <span class="hljs-string">r&apos;fr=&amp;expermode=&amp;force=&amp;pn={}&amp;rn=30&amp;gsm=1e&amp;1607477042497=&apos;</span>

Headers = {<span class="hljs-string">&apos;User-Agent&apos;</span>: <span class="hljs-string">&apos;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0&apos;</span>}

<span class="hljs-comment"># &#x767E;&#x5EA6;&#x56FE;&#x7247;&#x7F51;&#x5740;&#x5BF9;&#x5E94;&#x89E3;&#x7801;</span>
StrTable = {<span class="hljs-string">&apos;_z2C$q&apos;</span>: <span class="hljs-string">&apos;:&apos;</span>, <span class="hljs-string">&apos;_z&amp;e3B&apos;</span>: <span class="hljs-string">&apos;.&apos;</span>, <span class="hljs-string">&apos;AzdH3F&apos;</span>: <span class="hljs-string">&apos;/&apos;</span>}
CharTable = {<span class="hljs-string">&apos;w&apos;</span>: <span class="hljs-string">&apos;a&apos;</span>, <span class="hljs-string">&apos;k&apos;</span>: <span class="hljs-string">&apos;b&apos;</span>, <span class="hljs-string">&apos;v&apos;</span>: <span class="hljs-string">&apos;c&apos;</span>, <span class="hljs-string">&apos;1&apos;</span>: <span class="hljs-string">&apos;d&apos;</span>, <span class="hljs-string">&apos;j&apos;</span>: <span class="hljs-string">&apos;e&apos;</span>, <span class="hljs-string">&apos;u&apos;</span>: <span class="hljs-string">&apos;f&apos;</span>, <span class="hljs-string">&apos;2&apos;</span>: <span class="hljs-string">&apos;g&apos;</span>, <span class="hljs-string">&apos;i&apos;</span>: <span class="hljs-string">&apos;h&apos;</span>, <span class="hljs-string">&apos;t&apos;</span>: <span class="hljs-string">&apos;i&apos;</span>,
             <span class="hljs-string">&apos;3&apos;</span>: <span class="hljs-string">&apos;j&apos;</span>, <span class="hljs-string">&apos;h&apos;</span>: <span class="hljs-string">&apos;k&apos;</span>, <span class="hljs-string">&apos;s&apos;</span>: <span class="hljs-string">&apos;l&apos;</span>, <span class="hljs-string">&apos;4&apos;</span>: <span class="hljs-string">&apos;m&apos;</span>, <span class="hljs-string">&apos;g&apos;</span>: <span class="hljs-string">&apos;n&apos;</span>, <span class="hljs-string">&apos;5&apos;</span>: <span class="hljs-string">&apos;o&apos;</span>, <span class="hljs-string">&apos;r&apos;</span>: <span class="hljs-string">&apos;p&apos;</span>, <span class="hljs-string">&apos;q&apos;</span>: <span class="hljs-string">&apos;q&apos;</span>, <span class="hljs-string">&apos;6&apos;</span>: <span class="hljs-string">&apos;r&apos;</span>,
             <span class="hljs-string">&apos;f&apos;</span>: <span class="hljs-string">&apos;s&apos;</span>, <span class="hljs-string">&apos;p&apos;</span>: <span class="hljs-string">&apos;t&apos;</span>, <span class="hljs-string">&apos;7&apos;</span>: <span class="hljs-string">&apos;u&apos;</span>, <span class="hljs-string">&apos;e&apos;</span>: <span class="hljs-string">&apos;v&apos;</span>, <span class="hljs-string">&apos;o&apos;</span>: <span class="hljs-string">&apos;w&apos;</span>, <span class="hljs-string">&apos;8&apos;</span>: <span class="hljs-string">&apos;1&apos;</span>, <span class="hljs-string">&apos;d&apos;</span>: <span class="hljs-string">&apos;2&apos;</span>, <span class="hljs-string">&apos;n&apos;</span>: <span class="hljs-string">&apos;3&apos;</span>, <span class="hljs-string">&apos;9&apos;</span>: <span class="hljs-string">&apos;4&apos;</span>,
             <span class="hljs-string">&apos;c&apos;</span>: <span class="hljs-string">&apos;5&apos;</span>, <span class="hljs-string">&apos;m&apos;</span>: <span class="hljs-string">&apos;6&apos;</span>, <span class="hljs-string">&apos;0&apos;</span>: <span class="hljs-string">&apos;7&apos;</span>, <span class="hljs-string">&apos;b&apos;</span>: <span class="hljs-string">&apos;8&apos;</span>, <span class="hljs-string">&apos;l&apos;</span>: <span class="hljs-string">&apos;9&apos;</span>, <span class="hljs-string">&apos;a&apos;</span>: <span class="hljs-string">&apos;0&apos;</span>}

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_keywords_star</span><span class="hljs-params">(keywords, count, name, hu=HeadUrl, h=Headers, fp=FigPath)</span>:</span>
    fig_count = <span class="hljs-number">0</span>
    thirty_count = <span class="hljs-number">1</span>
    <span class="hljs-comment"># &#x5DF2;&#x7ECF;&#x4E0B;&#x8F7D;&#x5217;&#x8868;</span>
    all_load = {}
    <span class="hljs-keyword">while</span> fig_count &lt; count:
        all_url = hu.format(keywords, keywords, thirty_count * <span class="hljs-number">30</span>)
        strhtml = requests.get(all_url, headers=h, timeout=<span class="hljs-number">100</span>)
        <span class="hljs-comment"># &#x83B7;&#x53D6;&#x7F51;&#x9875;&#x6E90;&#x7801;</span>
        soup_txt = BeautifulSoup(strhtml.text, <span class="hljs-string">&apos;lxml&apos;</span>).text
        <span class="hljs-comment"># &#x67E5;&#x627E;</span>
        pattern_pic =  <span class="hljs-string">r&apos;&quot;objURL&quot;:&quot;(.*?)&quot;&apos;</span>
        <span class="hljs-comment"># &#x83B7;&#x5F97;&#x6240;&#x6709;url</span>
        pic_list = re.findall(pattern_pic, soup_txt)
        <span class="hljs-comment"># url&#x8F6C;&#x7801;&#x51FD;&#x6570;</span>
        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">trans_url</span><span class="hljs-params">(exstr, s=StrTable, c=CharTable)</span>:</span>
            <span class="hljs-keyword">for</span> ks <span class="hljs-keyword">in</span> s:
                <span class="hljs-keyword">if</span> ks <span class="hljs-keyword">in</span> exstr:
                    exstr = exstr.replace(ks, s[ks])
            new_url = <span class="hljs-string">&apos;&apos;</span>
            <span class="hljs-keyword">for</span> ke <span class="hljs-keyword">in</span> exstr:
                <span class="hljs-keyword">if</span> ke <span class="hljs-keyword">in</span> c:
                    new_url += c[ke]
                <span class="hljs-keyword">else</span>:
                    new_url += ke
            <span class="hljs-keyword">return</span> new_url
        <span class="hljs-keyword">for</span> kk <span class="hljs-keyword">in</span> pic_list:
            real_url = trans_url(kk)
            prex = real_url.split(<span class="hljs-string">&apos;.&apos;</span>)[<span class="hljs-number">-1</span>]
            <span class="hljs-keyword">if</span>  prex <span class="hljs-keyword">in</span> [<span class="hljs-string">&apos;jpg&apos;</span>, <span class="hljs-string">&apos;jpeg&apos;</span>, <span class="hljs-string">&apos;png&apos;</span>]:
                <span class="hljs-keyword">if</span> real_url <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> all_load:
                    all_load[real_url] = <span class="hljs-number">0</span>
                    <span class="hljs-comment"># &#x4E0B;&#x8F7D;&#x56FE;&#x7247;</span>
                    <span class="hljs-keyword">try</span>:
                        load_fig = requests.get(real_url)
                        figure_str = load_fig.content
                        <span class="hljs-keyword">if</span> len(figure_str) &gt; <span class="hljs-number">40000</span>:
                            <span class="hljs-comment"># &#x4FDD;&#x5B58;&#x56FE;&#x7247;</span>
                            <span class="hljs-keyword">with</span> open(<span class="hljs-string">r&apos;%s/%s_%s.%s&apos;</span> % (fp, name, fig_count, prex), <span class="hljs-string">&apos;wb&apos;</span>) <span class="hljs-keyword">as</span> fogs:
                                fogs.write(load_fig.content)
                                fig_count += <span class="hljs-number">1</span>
                                print(<span class="hljs-string">&apos;{}&#x5DF2;&#x7ECF;&#x4E0B;&#x8F7D;&#x5B8C;&#x6210;{}&#x5F20;&apos;</span>.format(keywords, fig_count))
                                <span class="hljs-keyword">if</span> fig_count == count:
                                    <span class="hljs-keyword">break</span>
                    <span class="hljs-keyword">except</span>:
                        <span class="hljs-keyword">pass</span>

        thirty_count += <span class="hljs-number">1</span>

get_keywords_star(<span class="hljs-string">&apos;&#x8A79;&#x59C6;&#x65AF;&apos;</span>, <span class="hljs-number">70</span>, <span class="hljs-string">&apos;LeBron&apos;</span>)
get_keywords_star(<span class="hljs-string">&apos;&#x79D1;&#x6BD4;&apos;</span>, <span class="hljs-number">70</span>, <span class="hljs-string">&apos;Kobe&apos;</span>)
</code></pre>
<h4 id="4213-&#x56FE;&#x7247;&#x6807;&#x6CE8;"><a name="4213-&#x56FE;&#x7247;&#x6807;&#x6CE8;" class="plugin-anchor" href="#4213-&#x56FE;&#x7247;&#x6807;&#x6CE8;"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.1.3 &#x56FE;&#x7247;&#x6807;&#x6CE8;</h4>
<p><img src="figure/4.4.jpg" style="zoom:100%;"></p>
<p>&#x8FD0;&#x884C;&#x51FA;&#x73B0;&#x754C;&#x9762;&#xFF0C;</p>
<p><img src="figure/4.5.jpg" style="zoom:100%;"></p>
<p>Open Dir &#x6253;&#x5F00;&#x5B58;&#x653E;&#x56FE;&#x7247;&#x7684;&#x8DEF;&#x5F84;&#xFF0C;&#x6587;&#x4EF6;&#x5217;&#x8868;&#x663E;&#x793A;</p>
<p><img src="figure/4.6.jpg" style="zoom:100%;"></p>
<p>&#x5F00;&#x59CB;&#x8FDB;&#x884C;&#x6807;&#x6CE8;&#xFF0C;&#x9009;&#x62E9;&#x56FE;&#x7247;&#x53F3;&#x51FB;&#xFF0C;&#x9009;&#x62E9;Create RectBox&#xFF0C;&#x9F20;&#x6807;&#x51FA;&#x73B0;&#x5341;&#x5B57;&#x6846;&#xFF0C;&#x5212;&#x51FA;&#x7C7B;&#x522B;&#x7684;&#x5BF9;&#x89D2;&#x7EBF;&#xFF0C;&#x5199;&#x5165;&#x6807;&#x7B7E;&#x5373;&#x53EF;&#x3002;&#x4FDD;&#x5B58;&#x540E;&#xFF0C;&#x6BCF;&#x4E2A;&#x56FE;&#x7247;&#x6587;&#x4EF6;&#x90FD;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;.xml&#x683C;&#x5F0F;&#x7684;&#x95EE;&#x6587;&#x4EF6;&#x3002;</p>
<p><img src="figure/4.7.jpg" style="zoom:100%;"></p>
<h3 id="422-&#x6570;&#x636E;&#x96C6;&#x5206;&#x5272;"><a name="422-&#x6570;&#x636E;&#x96C6;&#x5206;&#x5272;" class="plugin-anchor" href="#422-&#x6570;&#x636E;&#x96C6;&#x5206;&#x5272;"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.2 &#x6570;&#x636E;&#x96C6;&#x5206;&#x5272;</h3>
<p>&#x6309;&#x7167;&#x4E00;&#x5B9A;&#x6BD4;&#x4F8B;&#xFF0C;&#x5C06;&#x56FE;&#x7247;&#x548C;&#x5BF9;&#x5E94;&#x7684;.xml&#x6587;&#x4EF6;&#xFF0C;&#x5206;&#x522B;&#x526A;&#x5207;&#x5230;train&#x3001;test&#x6587;&#x4EF6;&#x5939;&#x4E2D;&#x3002;</p>
<p>python&#x7A0B;&#x5E8F;</p>
<pre><code class="lang-python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment"># author:AnFany</span>
<span class="hljs-comment"># datetime:2020/12/9 14:52</span>

<span class="hljs-comment"># &#x6839;&#x636E;&#x6BD4;&#x4F8B;&#xFF0C;&#x5C06;&#x56FE;&#x7247;&#x4EE5;&#x53CA;&#x6807;&#x6CE8;&#x7684;xml&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x5206;&#x5272;</span>
<span class="hljs-comment"># &#x8BE5;&#x7A0B;&#x5E8F;&#x9002;&#x5408;&#x56FE;&#x7247;&#x540D;&#x79F0;&#x4E3A;&#x7C7B;&#x522B;_&#x6570;&#x5B57;&#xFF0C;&#x540E;&#x7F00; &#x4E3A;.jpg,jpeg,png&#x7684;</span>

<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> shutil

<span class="hljs-comment"># &#x5206;&#x5272;&#x6570;&#x636E;&#x96C6;&#xFF0C;&#x5E76;&#x79FB;&#x52A8;&#x5230;&#x76F8;&#x5E94;&#x7684;&#x6587;&#x4EF6;&#x5939;</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">split_figure_daaset</span><span class="hljs-params">(filepath=<span class="hljs-string">r&apos;E:\odapi_gwt\models\workspace\training_demo_james_kobe\images&apos;</span>, percent=<span class="hljs-number">0.2</span>, anprex=<span class="hljs-string">&apos;xml&apos;</span>)</span>:</span>
    class_figure = {}
    file_list = os.listdir(filepath)
    <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> file_list:
        <span class="hljs-keyword">if</span> <span class="hljs-string">&apos;.&apos;</span> <span class="hljs-keyword">in</span> f:
            name, prex = f.split(<span class="hljs-string">&apos;.&apos;</span>)
            c, n = name.split(<span class="hljs-string">&apos;_&apos;</span>)
            <span class="hljs-comment"># &#x952E;&#xFF1A;&#x7C7B;</span>
            <span class="hljs-keyword">if</span> c <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> class_figure:
                class_figure[c] = {}
            <span class="hljs-comment"># xml&#x6587;&#x4EF6;</span>
            <span class="hljs-keyword">if</span> prex == anprex:
                <span class="hljs-keyword">if</span> anprex <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> class_figure[c]:
                    class_figure[c][anprex] = [f]
                <span class="hljs-keyword">else</span>:
                    class_figure[c][anprex].append(f)
            <span class="hljs-comment"># &#x56FE;&#x7247;&#x6587;&#x4EF6;</span>
            <span class="hljs-keyword">elif</span> prex <span class="hljs-keyword">in</span> [<span class="hljs-string">&apos;jpg&apos;</span>, <span class="hljs-string">&apos;jpeg&apos;</span>, <span class="hljs-string">&apos;png&apos;</span>]:
                <span class="hljs-keyword">if</span> <span class="hljs-string">&apos;%s.%s&apos;</span> % (name, anprex) <span class="hljs-keyword">in</span> file_list:
                    <span class="hljs-keyword">if</span> <span class="hljs-string">&apos;fig&apos;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> class_figure[c]:
                        class_figure[c][<span class="hljs-string">&apos;fig&apos;</span>] = [f]
                    <span class="hljs-keyword">else</span>:
                        class_figure[c][<span class="hljs-string">&apos;fig&apos;</span>].append(f)
    <span class="hljs-comment"># &#x5F00;&#x59CB;&#x5206;&#x5272;</span>
    <span class="hljs-keyword">for</span> dc <span class="hljs-keyword">in</span> class_figure:
        length = len(class_figure[dc][<span class="hljs-string">&apos;fig&apos;</span>])
        test_len = int(length * percent)
        <span class="hljs-comment"># &#x968F;&#x673A;&#x9009;&#x62E9;&#x51E0;&#x4E2A;</span>
        all_sign = np.arange(length)
        test_sign = np.random.choice(all_sign, test_len, replace=<span class="hljs-keyword">False</span>)
        test_file = list(np.array(class_figure[dc][<span class="hljs-string">&apos;fig&apos;</span>])[test_sign]) + \
                    list(np.array(class_figure[dc][<span class="hljs-string">&apos;xml&apos;</span>])[test_sign])

        train_sign = [hj <span class="hljs-keyword">for</span> hj <span class="hljs-keyword">in</span> all_sign <span class="hljs-keyword">if</span> hj <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> test_sign]
        train_file = list(np.array(class_figure[dc][<span class="hljs-string">&apos;fig&apos;</span>])[train_sign]) + \
                    list(np.array(class_figure[dc][<span class="hljs-string">&apos;xml&apos;</span>])[train_sign])

        <span class="hljs-comment"># &#x5F00;&#x59CB;&#x79FB;&#x52A8;&#x6D4B;&#x8BD5;&#x6587;&#x4EF6;</span>
        <span class="hljs-keyword">for</span> tfile <span class="hljs-keyword">in</span> test_file:
            shutil.move(<span class="hljs-string">&apos;%s/%s&apos;</span> % (filepath, tfile), <span class="hljs-string">&apos;%s/test&apos;</span> % filepath)

        <span class="hljs-comment"># &#x5F00;&#x59CB;&#x79FB;&#x52A8;&#x8BAD;&#x7EC3;&#x6587;&#x4EF6;</span>
        <span class="hljs-keyword">for</span> tfile <span class="hljs-keyword">in</span> train_file:
            shutil.move(<span class="hljs-string">&apos;%s/%s&apos;</span> % (filepath, tfile), <span class="hljs-string">&apos;%s/train&apos;</span> % filepath)

    <span class="hljs-keyword">return</span> <span class="hljs-string">&apos;&#x6570;&#x636E;&#x96C6;&#x5206;&#x5272;&#x5B8C;&#x6BD5;&apos;</span>

print(split_figure_daaset())
</code></pre>
<p><img src="figure/4.8.jpg" style="zoom:100%;"></p>
<h3 id="423-&#x521B;&#x5EFA;&#x6807;&#x7B7E;&#x6620;&#x5C04;"><a name="423-&#x521B;&#x5EFA;&#x6807;&#x7B7E;&#x6620;&#x5C04;" class="plugin-anchor" href="#423-&#x521B;&#x5EFA;&#x6807;&#x7B7E;&#x6620;&#x5C04;"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.3 &#x521B;&#x5EFA;&#x6807;&#x7B7E;&#x6620;&#x5C04;</h3>
<p>&#x6839;&#x636E;&#x6570;&#x636E;&#x96C6;&#x4E2D;&#x7684;&#x7C7B;&#x522B;&#xFF0C;&#x521B;&#x5EFA;&#x5F62;&#x5982;&#x4E0B;&#x9762;&#x683C;&#x5F0F;&#x7684;&#x6620;&#x5C04;&#x6587;&#x4EF6;&#xFF0C;&#x653E;&#x5728;&#x6587;&#x4EF6;&#x5939;annotations&#x4E2D;&#x3002;&#x5E76;&#x5C06;&#x8BE5;&#x6587;&#x4EF6;&#x7684;&#x540E;&#x7F00;&#x540D;&#x5B9A;&#x4E49;&#x4E3A;.pbtxt&#xFF0C;&#x540D;&#x79F0;&#x4E0D;&#x9650;&#x5236;&#xFF0C;&#x793A;&#x56FE;&#xFF0C;&#x6CE8;&#x610F;&#x7C7B;&#x522B;&#x4E4B;&#x95F4;&#x4E0D;&#x8981;&#x7559;&#x6709;&#x7A7A;&#x683C;&#x3002;</p>
<p><img src="figure/4.9.png" style="zoom:100%;"></p>
<h3 id="424-&#x8F6C;xml&#x4E3A;record&#x683C;&#x5F0F;"><a name="424-&#x8F6C;xml&#x4E3A;record&#x683C;&#x5F0F;" class="plugin-anchor" href="#424-&#x8F6C;xml&#x4E3A;record&#x683C;&#x5F0F;"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.4 &#x8F6C;*.xml&#x4E3A;*.record&#x683C;&#x5F0F;</h3>
<p>python&#x7A0B;&#x5E8F;</p>
<pre><code class="lang-python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment"># author:AnFany</span>
<span class="hljs-comment"># datetime:2020/12/9 16:16</span>

<span class="hljs-comment"># &#x5C06;.xml&#x683C;&#x5F0F;&#x8F6C;&#x5316;&#x4E3A;tfrecord&#x683C;&#x5F0F;&#x7684;&#x6570;&#x636E;&#x6587;&#x4EF6;</span>

<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> glob
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> io
<span class="hljs-keyword">import</span> xml.etree.ElementTree <span class="hljs-keyword">as</span> ET
os.environ[<span class="hljs-string">&apos;TF_CPP_MIN_LOG_LEVEL&apos;</span>] = <span class="hljs-string">&apos;2&apos;</span>    <span class="hljs-comment"># Suppress TensorFlow logging (1)</span>
<span class="hljs-keyword">import</span> tensorflow.compat.v1 <span class="hljs-keyword">as</span> tf
<span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image
<span class="hljs-keyword">from</span> object_detection.utils <span class="hljs-keyword">import</span> dataset_util, label_map_util
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> namedtuple

<span class="hljs-comment"># .pbtxt&#x6587;&#x4EF6;&#x8DEF;&#x52B2;</span>
PathPbtxt = <span class="hljs-string">r&apos;E:\odapi_gwt\models\workspace\training_demo_RiverFloatage\annotations\river_floatage.pbtxt&apos;</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">xml_to_df</span><span class="hljs-params">(pxf, ppb=PathPbtxt)</span>:</span>
    <span class="hljs-comment"># &#x6839;&#x636E;pbtxt&#x6587;&#x4EF6;&#xFF0C;&#x5C06;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x7C7B;&#x522B;&#x53D8;&#x4E3A;&#x6570;&#x5B57;&#x7C7B;&#x522B;</span>
    label_map = label_map_util.load_labelmap(ppb)
    label_map_dict = label_map_util.get_label_map_dict(label_map)

    <span class="hljs-comment"># &#x904D;&#x5386;.xml&#x6587;&#x4EF6;&#xFF0C;&#x5C06;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x5408;&#x5E76;&#x6210;pandas&#x7684;DataFrame&#x683C;&#x5F0F;</span>
    xml_list = []
    <span class="hljs-keyword">for</span> subfile <span class="hljs-keyword">in</span> os.listdir(pxf):
        name, prex = subfile.split(<span class="hljs-string">&apos;.&apos;</span>)
        <span class="hljs-keyword">if</span> prex == <span class="hljs-string">&apos;xml&apos;</span>:
            <span class="hljs-comment"># &#x89E3;&#x6790;XML&#x6587;&#x4EF6;</span>
            tree = ET.parse(<span class="hljs-string">&apos;%s/%s&apos;</span> % (pxf, subfile))
            root = tree.getroot()
            <span class="hljs-keyword">for</span> member <span class="hljs-keyword">in</span> root.findall(<span class="hljs-string">&apos;object&apos;</span>):
                value = (root.find(<span class="hljs-string">&apos;filename&apos;</span>).text,  <span class="hljs-comment">#&#x5BF9;&#x5E94;&#x7684;&#x56FE;&#x7247;</span>
                         int(root.find(<span class="hljs-string">&apos;size&apos;</span>)[<span class="hljs-number">0</span>].text),  <span class="hljs-comment"># &#x56FE;&#x7247;&#x7684;&#x5BBD;&#x5EA6;</span>
                         int(root.find(<span class="hljs-string">&apos;size&apos;</span>)[<span class="hljs-number">1</span>].text),  <span class="hljs-comment"># &#x56FE;&#x7247;&#x7684;&#x9AD8;&#x5EA6;</span>
                         member[<span class="hljs-number">0</span>].text,  <span class="hljs-comment"># &#x7C7B;&#x522B;</span>
                         int(member[<span class="hljs-number">4</span>][<span class="hljs-number">0</span>].text),          <span class="hljs-comment"># x&#x6700;&#x5C0F;</span>
                         int(member[<span class="hljs-number">4</span>][<span class="hljs-number">1</span>].text),          <span class="hljs-comment"># y&#x6700;&#x5C0F;</span>
                         int(member[<span class="hljs-number">4</span>][<span class="hljs-number">2</span>].text),          <span class="hljs-comment"># x&#x6700;&#x5927;</span>
                         int(member[<span class="hljs-number">4</span>][<span class="hljs-number">3</span>].text)           <span class="hljs-comment"># y&#x6700;&#x5927;</span>
                         )
                xml_list.append(value)
        column_name = [<span class="hljs-string">&apos;filename&apos;</span>, <span class="hljs-string">&apos;width&apos;</span>, <span class="hljs-string">&apos;height&apos;</span>, <span class="hljs-string">&apos;class&apos;</span>, <span class="hljs-string">&apos;xmin&apos;</span>, <span class="hljs-string">&apos;ymin&apos;</span>, <span class="hljs-string">&apos;xmax&apos;</span>, <span class="hljs-string">&apos;ymax&apos;</span>]
        xml_df = pd.DataFrame(xml_list, columns=column_name)

    <span class="hljs-keyword">return</span> xml_df, label_map_dict

<span class="hljs-comment"># df&#x683C;&#x5F0F;&#x6570;&#x636E;&#x5206;&#x7EC4;</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">split</span><span class="hljs-params">(df, group)</span>:</span>
    data = namedtuple(<span class="hljs-string">&apos;data&apos;</span>, [<span class="hljs-string">&apos;filename&apos;</span>, <span class="hljs-string">&apos;object&apos;</span>])
    gb = df.groupby(group)
    <span class="hljs-keyword">return</span> [data(filename, gb.get_group(x)) <span class="hljs-keyword">for</span> filename, x <span class="hljs-keyword">in</span> zip(gb.groups.keys(), gb.groups)]

<span class="hljs-comment"># &#x521B;&#x5EFA;example</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_tf_example</span><span class="hljs-params">(group, ld, path)</span>:</span>
    <span class="hljs-keyword">with</span> tf.gfile.GFile(os.path.join(path, <span class="hljs-string">&apos;{}&apos;</span>.format(group.filename)), <span class="hljs-string">&apos;rb&apos;</span>) <span class="hljs-keyword">as</span> fid:
        encoded_jpg = fid.read()
    encoded_jpg_io = io.BytesIO(encoded_jpg)
    image = Image.open(encoded_jpg_io)
    width, height = image.size

    filename = group.filename.encode(<span class="hljs-string">&apos;utf8&apos;</span>)
    image_format = <span class="hljs-string">b&apos;jpg&apos;</span>
    xmins = []
    xmaxs = []
    ymins = []
    ymaxs = []
    classes_text = []
    classes = []

    <span class="hljs-keyword">for</span> index, row <span class="hljs-keyword">in</span> group.object.iterrows():
        xmins.append(row[<span class="hljs-string">&apos;xmin&apos;</span>] / width)
        xmaxs.append(row[<span class="hljs-string">&apos;xmax&apos;</span>] / width)
        ymins.append(row[<span class="hljs-string">&apos;ymin&apos;</span>] / height)
        ymaxs.append(row[<span class="hljs-string">&apos;ymax&apos;</span>] / height)
        classes_text.append(row[<span class="hljs-string">&apos;class&apos;</span>].encode(<span class="hljs-string">&apos;utf8&apos;</span>))
        classes.append(ld[row[<span class="hljs-string">&apos;class&apos;</span>]])

    tf_example = tf.train.Example(features=tf.train.Features(feature={
        <span class="hljs-string">&apos;image/height&apos;</span>: dataset_util.int64_feature(height),
        <span class="hljs-string">&apos;image/width&apos;</span>: dataset_util.int64_feature(width),
        <span class="hljs-string">&apos;image/filename&apos;</span>: dataset_util.bytes_feature(filename),
        <span class="hljs-string">&apos;image/source_id&apos;</span>: dataset_util.bytes_feature(filename),
        <span class="hljs-string">&apos;image/encoded&apos;</span>: dataset_util.bytes_feature(encoded_jpg),
        <span class="hljs-string">&apos;image/format&apos;</span>: dataset_util.bytes_feature(image_format),
        <span class="hljs-string">&apos;image/object/bbox/xmin&apos;</span>: dataset_util.float_list_feature(xmins),
        <span class="hljs-string">&apos;image/object/bbox/xmax&apos;</span>: dataset_util.float_list_feature(xmaxs),
        <span class="hljs-string">&apos;image/object/bbox/ymin&apos;</span>: dataset_util.float_list_feature(ymins),
        <span class="hljs-string">&apos;image/object/bbox/ymax&apos;</span>: dataset_util.float_list_feature(ymaxs),
        <span class="hljs-string">&apos;image/object/class/text&apos;</span>: dataset_util.bytes_list_feature(classes_text),
        <span class="hljs-string">&apos;image/object/class/label&apos;</span>: dataset_util.int64_list_feature(classes),
    }))
    <span class="hljs-keyword">return</span> tf_example

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">xml_to_record</span><span class="hljs-params">(pxf, pre)</span>:</span>
    writer = tf.python_io.TFRecordWriter(pre)
    xml_df, label_map_dict = xml_to_df(pxf)
    grouped = split(xml_df, <span class="hljs-string">&apos;filename&apos;</span>)
    <span class="hljs-keyword">for</span> group <span class="hljs-keyword">in</span> grouped:
        tf_example = create_tf_example(group, label_map_dict, pxf)
        writer.write(tf_example.SerializeToString())
    writer.close()
    print(<span class="hljs-string">&apos;&#x8F6C;&#x5316;&#x5B8C;&#x6210;&apos;</span>)

<span class="hljs-comment"># .xml&#x5B58;&#x50A8;&#x7684;&#x8DEF;&#x5F84;\&#x56FE;&#x7247;&#x8DEF;&#x5F84;</span>
PathXmlFig = <span class="hljs-string">r&apos;E:\odapi_gwt\models\workspace\training_demo_RiverFloatage\images&apos;</span>
<span class="hljs-comment"># .record&#x8F93;&#x51FA;&#x7684;&#x8DEF;&#x5F84;</span>
PathRecord = <span class="hljs-string">r&apos;E:\odapi_gwt\models\workspace\training_demo_RiverFloatage\annotations&apos;</span>

<span class="hljs-comment"># &#x8BAD;&#x7EC3;&#x6587;&#x4EF6;&#x548C;&#x6D4B;&#x8BD5;&#x6587;&#x4EF6;</span>
xml_to_record(os.path.join(PathXmlFig, <span class="hljs-string">&apos;test&apos;</span>), os.path.join(PathRecord, <span class="hljs-string">&apos;test.record&apos;</span>))
xml_to_record(os.path.join(PathXmlFig, <span class="hljs-string">&apos;train&apos;</span>), os.path.join(PathRecord, <span class="hljs-string">&apos;train.record&apos;</span>))
</code></pre>
<p>&#x7A0B;&#x5E8F;&#x548C;*.xml&#x6587;&#x4EF6;&#x5BF9;&#x5E94;&#x8BF4;&#x660E;&#xFF1A;</p>
<p><img src="figure/4.10.jpg" style="zoom:100%;"></p>
<p>&#x8FD0;&#x884C;&#x5B8C;&#x6BD5;&#x540E;</p>
<p><img src="figure/4.11.jpg" style="zoom:100%;"></p>
<h2 id="43-&#x6784;&#x5EFA;&#x8BAD;&#x7EC3;&#x4EFB;&#x52A1;"><a name="43-&#x6784;&#x5EFA;&#x8BAD;&#x7EC3;&#x4EFB;&#x52A1;" class="plugin-anchor" href="#43-&#x6784;&#x5EFA;&#x8BAD;&#x7EC3;&#x4EFB;&#x52A1;"><i class="fa fa-link" aria-hidden="true"></i></a>4.3 &#x6784;&#x5EFA;&#x8BAD;&#x7EC3;&#x4EFB;&#x52A1;</h2>
<h3 id="431-&#x83B7;&#x53D6;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;"><a name="431-&#x83B7;&#x53D6;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;" class="plugin-anchor" href="#431-&#x83B7;&#x53D6;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;"><i class="fa fa-link" aria-hidden="true"></i></a>4.3.1 &#x83B7;&#x53D6;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;</h3>
<p>&#x4F7F;&#x7528;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;&#x8FDB;&#x884C;&#x8BAD;&#x7EC3;&#xFF0C;&#x5C06;&#x524D;&#x9762;&#x4E0B;&#x8F7D;&#x597D;&#x7684;&#x6A21;&#x578B;&#x6587;&#x4EF6;&#x5939;&#x590D;&#x5236;&#x5230;pre-trained-models&#x6587;&#x4EF6;&#x5939;&#x5185;&#xFF0C;&#x7ED3;&#x6784;&#x548C;&#x4E0A;&#x56FE;&#x7C7B;&#x4F3C;&#x3002;&#x53EF;&#x4EE5;&#x5C06;&#x591A;&#x4E2A;&#x6A21;&#x578B;&#x6309;&#x7167;&#x540C;&#x6837;&#x65B9;&#x5F0F;&#x590D;&#x5236;&#x8FC7;&#x6765;&#x3002;</p>
<p><img src="figure/4.12.png" style="zoom:100%;"></p>
<h3 id="432-&#x914D;&#x7F6E;&#x8BAD;&#x7EC3;&#x7BA1;&#x9053;"><a name="432-&#x914D;&#x7F6E;&#x8BAD;&#x7EC3;&#x7BA1;&#x9053;" class="plugin-anchor" href="#432-&#x914D;&#x7F6E;&#x8BAD;&#x7EC3;&#x7BA1;&#x9053;"><i class="fa fa-link" aria-hidden="true"></i></a>4.3.2 &#x914D;&#x7F6E;&#x8BAD;&#x7EC3;&#x7BA1;&#x9053;</h3>
<p>&#x5728;models&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#x9762;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x5C06;&#x8981;&#x7528;&#x7684;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;&#x4E2D;&#x7684;pipeline.config&#x6587;&#x4EF6;&#x590D;&#x5236;&#x5230;&#x8BE5;&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#x9762;&#xFF0C;</p>
<p><img src="figure/4.13.jpg" style="zoom:100%;"></p>
<p>&#x4E0B;&#x9762;&#x5BF9;&#x8BE5;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#xFF0C;&#x5176;&#x4E2D;&#x5173;&#x4E8E;&#x8DEF;&#x5F84;&#x7684;&#x8BBE;&#x7F6E;&#x90FD;&#x8BBE;&#x7F6E;&#x4E3A;E:\odapi_gwt\models\workspace\training_demo_james_kobe&#x7684;&#x76F8;&#x5BF9;&#x8DEF;&#x5F84;&#x3002;</p>
<h4 id="4321-&#x8BBE;&#x7F6E;&#x68C0;&#x6D4B;&#x5BF9;&#x8C61;&#x7C7B;"><a name="4321-&#x8BBE;&#x7F6E;&#x68C0;&#x6D4B;&#x5BF9;&#x8C61;&#x7C7B;" class="plugin-anchor" href="#4321-&#x8BBE;&#x7F6E;&#x68C0;&#x6D4B;&#x5BF9;&#x8C61;&#x7C7B;"><i class="fa fa-link" aria-hidden="true"></i></a>4.3.2.1 &#x8BBE;&#x7F6E;&#x68C0;&#x6D4B;&#x5BF9;&#x8C61;&#x7C7B;</h4>
<p><img src="figure/4.14.png" style="zoom:100%;"></p>
<h4 id="4322-&#x8BBE;&#x7F6E;&#x6279;&#x8BAD;&#x7EC3;&#x5927;&#x5C0F;"><a name="4322-&#x8BBE;&#x7F6E;&#x6279;&#x8BAD;&#x7EC3;&#x5927;&#x5C0F;" class="plugin-anchor" href="#4322-&#x8BBE;&#x7F6E;&#x6279;&#x8BAD;&#x7EC3;&#x5927;&#x5C0F;"><i class="fa fa-link" aria-hidden="true"></i></a>4.3.2.2 &#x8BBE;&#x7F6E;&#x6279;&#x8BAD;&#x7EC3;&#x5927;&#x5C0F;</h4>
<p><img src="figure/4.15.png" style="zoom:100%;"></p>
<h4 id="4323-&#x6A21;&#x578B;&#x914D;&#x7F6E;"><a name="4323-&#x6A21;&#x578B;&#x914D;&#x7F6E;" class="plugin-anchor" href="#4323-&#x6A21;&#x578B;&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>4.3.2.3 &#x6A21;&#x578B;&#x914D;&#x7F6E;</h4>
<p><img src="figure/4.16.png" style="zoom:100%;"></p>
<h4 id="4324-&#x8BAD;&#x7EC3;&#x6570;&#x636E;&#x96C6;"><a name="4324-&#x8BAD;&#x7EC3;&#x6570;&#x636E;&#x96C6;" class="plugin-anchor" href="#4324-&#x8BAD;&#x7EC3;&#x6570;&#x636E;&#x96C6;"><i class="fa fa-link" aria-hidden="true"></i></a>4.3.2.4 &#x8BAD;&#x7EC3;&#x6570;&#x636E;&#x96C6;</h4>
<p><img src="figure/4.17.png" style="zoom:100%;"></p>
<h4 id="4325-&#x6D4B;&#x8BD5;&#x6570;&#x636E;&#x96C6;"><a name="4325-&#x6D4B;&#x8BD5;&#x6570;&#x636E;&#x96C6;" class="plugin-anchor" href="#4325-&#x6D4B;&#x8BD5;&#x6570;&#x636E;&#x96C6;"><i class="fa fa-link" aria-hidden="true"></i></a>4.3.2.5 &#x6D4B;&#x8BD5;&#x6570;&#x636E;&#x96C6;</h4>
<p><img src="figure/4.18.png" style="zoom:100%;"></p>
<h3 id="433-&#x8BAD;&#x7EC3;&#x6A21;&#x578B;"><a name="433-&#x8BAD;&#x7EC3;&#x6A21;&#x578B;" class="plugin-anchor" href="#433-&#x8BAD;&#x7EC3;&#x6A21;&#x578B;"><i class="fa fa-link" aria-hidden="true"></i></a>4.3.3 &#x8BAD;&#x7EC3;&#x6A21;&#x578B;</h3>
<p>&#x5C06;/models/research/object_detection/model_main_tf2.py&#x6587;&#x4EF6;&#xFF0C;&#x590D;&#x5236;&#x5230;training_demo_james_kobe&#x6587;&#x4EF6;&#x5939;&#x5185;&#x3002;</p>
<p><img src="figure/4.19.jpg" style="zoom:100%;"></p>
<p>&#x6FC0;&#x6D3B;&#x865A;&#x62DF;&#x73AF;&#x5883;&#xFF0C;&#x6253;&#x5F00;training_demo_james_kobe&#xFF0C;&#x8FD0;&#x884C;&#x547D;&#x4EE4;</p>
<p>==python model_main_tf2.py --model_dir=models/ssd_resnet50_v1_fpn_640 --pipeline_config_path=models/ssd_resnet50_v1_fpn_640/pipeline.config==</p>
<p><img src="figure/4.20.jpg" style="zoom:100%;"></p>
<h4 id="4331-no-module-named-lvis"><a name="4331-no-module-named-lvis" class="plugin-anchor" href="#4331-no-module-named-lvis"><i class="fa fa-link" aria-hidden="true"></i></a>4.3.3.1 No module named &apos;lvis&apos;</h4>
<p><img src="figure/4.21.jpg" style="zoom:100%;"></p>
<p>&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#xFF1A;&#x6FC0;&#x6D3B;&#x865A;&#x62DF;&#x73AF;&#x5883;&#xFF0C;&#x8FD0;&#x884C;&#x547D;&#x4EE4; ==pip install lvis==</p>
<p><img src="figure/4.22.jpg" style="zoom:100%;"></p>
<h4 id="4332-no-module-named-official"><a name="4332-no-module-named-official" class="plugin-anchor" href="#4332-no-module-named-official"><i class="fa fa-link" aria-hidden="true"></i></a>4.3.3.2 No module named &apos;official&apos;</h4>
<p><img src="figure/4.23.jpg" style="zoom:100%;"></p>
<p>&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#xFF1A;&#x5C06;</p>
<p><img src="figure/4.24.jpg" style="zoom:100%;"></p>
<p>&#x590D;&#x5236;&#x5230;</p>
<p><img src="figure/4.25.jpg" style="zoom:100%;"></p>
<h4 id="4333-no-module-named-yaml"><a name="4333-no-module-named-yaml" class="plugin-anchor" href="#4333-no-module-named-yaml"><i class="fa fa-link" aria-hidden="true"></i></a>4.3.3.3 No module named &apos;yaml&apos;</h4>
<p><img src="figure/4.26.jpg" style="zoom:100%;"></p>
<p>&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#xFF1A;&#x6FC0;&#x6D3B;&#x865A;&#x62DF;&#x73AF;&#x5883;&#xFF0C;&#x8FD0;&#x884C;&#x547D;&#x4EE4; ==pip install pyyaml==</p>
<p><img src="figure/4.27.jpg" style="zoom:100%;"></p>
<h4 id="4334-&#x5F00;&#x59CB;&#x8BAD;&#x7EC3;"><a name="4334-&#x5F00;&#x59CB;&#x8BAD;&#x7EC3;" class="plugin-anchor" href="#4334-&#x5F00;&#x59CB;&#x8BAD;&#x7EC3;"><i class="fa fa-link" aria-hidden="true"></i></a>4.3.3.4 &#x5F00;&#x59CB;&#x8BAD;&#x7EC3;</h4>
<p><img src="figure/4.28.jpg" style="zoom:100%;"></p>
<h3 id="434-&#x8BAD;&#x7EC3;&#x8FC7;&#x7A0B;&#x53EF;&#x89C6;&#x5316;"><a name="434-&#x8BAD;&#x7EC3;&#x8FC7;&#x7A0B;&#x53EF;&#x89C6;&#x5316;" class="plugin-anchor" href="#434-&#x8BAD;&#x7EC3;&#x8FC7;&#x7A0B;&#x53EF;&#x89C6;&#x5316;"><i class="fa fa-link" aria-hidden="true"></i></a>4.3.4 &#x8BAD;&#x7EC3;&#x8FC7;&#x7A0B;&#x53EF;&#x89C6;&#x5316;</h3>
<p>&#x5728;&#x6253;&#x5F00;Anaconda Prompt&#xFF0C;&#x6FC0;&#x6D3B;&#x865A;&#x62DF;&#x73AF;&#x5883;&#xFF0C;&#x6253;&#x5F00;&#x8DEF;&#x5F84;&#xFF0C;&#x6267;&#x884C;==tensorboard --logdir=models/ssd_resnet50_v1_fpn_640==</p>
<p><img src="figure/4.29.jpg" style="zoom:100%;"></p>
<p><img src="figure/4.30.jpg" style="zoom:100%;"></p>
<p><img src="figure/4.31.jpg" style="zoom:100%;"></p>
<h2 id="44-&#x8BC4;&#x4F30;&#x6A21;&#x578B;"><a name="44-&#x8BC4;&#x4F30;&#x6A21;&#x578B;" class="plugin-anchor" href="#44-&#x8BC4;&#x4F30;&#x6A21;&#x578B;"><i class="fa fa-link" aria-hidden="true"></i></a>4.4 &#x8BC4;&#x4F30;&#x6A21;&#x578B;</h2>
<p>&#x4E09;&#x79CD;&#x8BC4;&#x4F30;&#x6807;&#x51C6;&#xFF0C;&#x5BF9;&#x5E94;&#x4FEE;&#x6539;pipeline.config&#x6587;&#x4EF6;&#x7684;178-179 &#x884C;&#x3002;</p>
<h3 id="441-&#x8BBE;&#x7F6E;&#x8BC4;&#x4F30;&#x6807;&#x51C6;"><a name="441-&#x8BBE;&#x7F6E;&#x8BC4;&#x4F30;&#x6807;&#x51C6;" class="plugin-anchor" href="#441-&#x8BBE;&#x7F6E;&#x8BC4;&#x4F30;&#x6807;&#x51C6;"><i class="fa fa-link" aria-hidden="true"></i></a>4.4.1 &#x8BBE;&#x7F6E;&#x8BC4;&#x4F30;&#x6807;&#x51C6;</h3>
<p><img src="figure/4.32.jpg" style="zoom:100%;"></p>
<ul>
<li>PASCAL VOC 2010 detection metric</li>
</ul>
<p>metrics_set=&apos;pascal_voc_detection_metrics&apos;</p>
<ul>
<li>COCO detection metrics</li>
</ul>
<p>metrics_set=&apos;coco_detection_metrics&apos;</p>
<ul>
<li>Open Images V2 detection metric</li>
</ul>
<p>metrics_set=&apos;oid_V2_detection_metrics&apos;</p>
<h3 id="442-&#x8BC4;&#x4F30;"><a name="442-&#x8BC4;&#x4F30;" class="plugin-anchor" href="#442-&#x8BC4;&#x4F30;"><i class="fa fa-link" aria-hidden="true"></i></a>4.4.2 &#x8BC4;&#x4F30;</h3>
<p>&#x5728;&#x6253;&#x5F00;Anaconda Prompt&#xFF0C;&#x6FC0;&#x6D3B;&#x865A;&#x62DF;&#x73AF;&#x5883;&#xFF0C;&#x6253;&#x5F00;&#x8DEF;&#x5F84;&#xFF0C;&#x6267;&#x884C;</p>
<p>==python model_main_tf2.py --model_dir=models/ssd_resnet50_v1_fpn_640 --pipeline_config_path=models/ssd_resnet50_v1_fpn_640/pipeline.config --checkpoint_dir=models/ssd_resnet50_v1_fpn_640==</p>
<p><img src="figure/4.33.jpg" style="zoom:100%;"></p>
<p>&#x8BC4;&#x4F30;&#x7684;&#x662F;&#x6700;&#x65B0;&#x4FDD;&#x5B58;&#x7684;&#x6A21;&#x578B;</p>
<p><img src="figure/4.34.jpg" style="zoom:100%;"></p>
<p>&#x5982;&#x679C;&#x51FA;&#x73B0; &apos;numpy.float64&apos; object cannot be interpreted as an integer&#x9519;&#x8BEF;&#xFF0C;</p>
<p><img src="figure/4.35.jpg" style="zoom:100%;"></p>
<p>&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#xFF1A;&#x627E;&#x5230;&#x62A5;&#x9519;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x9700;&#x8981;&#x4FEE;&#x6539;507&#x3001;508&#x884C;</p>
<p><img src="figure/4.36.jpg" style="zoom:100%;"></p>
<p>&#x4FEE;&#x6539;&#x540E;&#xFF1A;</p>
<p><img src="figure/4.37.jpg" style="zoom:100%;"></p>
<p>&#x4FDD;&#x5B58;&#xFF0C;&#x518D;&#x6B21;&#x8FD0;&#x884C;&#x5373;&#x53EF;&#x3002;</p>
<p><img src="figure/4.38.jpg" style="zoom:100%;"></p>
<h3 id="443-&#x8BC4;&#x4F30;&#x7ED3;&#x679C;&#x67E5;&#x770B;"><a name="443-&#x8BC4;&#x4F30;&#x7ED3;&#x679C;&#x67E5;&#x770B;" class="plugin-anchor" href="#443-&#x8BC4;&#x4F30;&#x7ED3;&#x679C;&#x67E5;&#x770B;"><i class="fa fa-link" aria-hidden="true"></i></a>4.4.3 &#x8BC4;&#x4F30;&#x7ED3;&#x679C;&#x67E5;&#x770B;</h3>
<p>&#x8BC4;&#x4F30;&#x7ED3;&#x679C;&#x4FDD;&#x5B58;&#x5728;</p>
<p><img src="figure/4.39.jpg" style="zoom:100%;"></p>
<p><img src="figure/4.40.jpg" style="zoom:100%;"></p>
<h2 id="45-&#x6A21;&#x578B;&#x4FDD;&#x5B58;"><a name="45-&#x6A21;&#x578B;&#x4FDD;&#x5B58;" class="plugin-anchor" href="#45-&#x6A21;&#x578B;&#x4FDD;&#x5B58;"><i class="fa fa-link" aria-hidden="true"></i></a>4.5 &#x6A21;&#x578B;&#x4FDD;&#x5B58;</h2>
<p> &#x6A21;&#x578B;&#x8BAD;&#x7EC3;&#x5B8C;&#x6BD5;&#x540E;&#xFF0C;&#x5C06;models/research/object_detection/exporter_main_v2.py&#x6587;&#x4EF6;&#x590D;&#x5236;&#x5230;&#x4E0B;&#x9762;&#x6587;&#x4EF6;&#x5939;&#x4E2D;&#x3002;</p>
<p><img src="figure/4.41.jpg" style="zoom:100%;"></p>
<p>&#x6FC0;&#x6D3B;&#x865A;&#x62DF;&#x73AF;&#x5883;&#xFF0C;cd&#x6253;&#x5F00;&#x8DEF;&#x5F84;E:\odapi_gwt\models\workspace\training_demo_james_kobe&#xFF0C;&#x6267;&#x884C;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;</p>
<p>==python exporter_main_v2.py --input_type image_tensor --pipeline_config_path models\ssd_resnet50_v1_fpn_640\pipeline.config --trained_checkpoint_dir models\ssd_resnet50_v1_fpn_640\ --output_directory exported-models\Lebron_Kobe_Model==</p>
<p>&#x51FA;&#x73B0;&#x9519;&#x8BEF;</p>
<p><img src="figure/4.42.jpg" style="zoom:100%;"></p>
<p>&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#xFF0C;&#x4FEE;&#x6539;&#x84DD;&#x6846;&#x4E2D;&#x7684;&#x6587;&#x4EF6;&#x7684;&#x7B2C;140&#x884C;&#xFF0C;</p>
<p><img src="figure/4.43.jpg" style="zoom:100%;"></p>
<p>&#x4FEE;&#x6539;&#x540E;&#xFF0C;</p>
<p><img src="figure/4.44.jpg" style="zoom:100%;"></p>
<p>&#x4FDD;&#x5B58;&#xFF0C;&#x518D;&#x8FD0;&#x884C;&#x547D;&#x4EE4;&#x5373;&#x53EF;&#x3002;</p>
<p><img src="figure/4.45.jpg" style="zoom:100%;"></p>
<p>&#x8FD0;&#x884C;&#x5B8C;&#x6210;&#x540E;&#x7684;&#x7ED3;&#x679C;</p>
<p><img src="figure/4.46.jpg" style="zoom:100%;"></p>
<h2 id="46-&#x6A21;&#x578B;&#x9884;&#x6D4B;"><a name="46-&#x6A21;&#x578B;&#x9884;&#x6D4B;" class="plugin-anchor" href="#46-&#x6A21;&#x578B;&#x9884;&#x6D4B;"><i class="fa fa-link" aria-hidden="true"></i></a>4.6 &#x6A21;&#x578B;&#x9884;&#x6D4B;</h2>
<p>&#x5229;&#x7528;&#x4FDD;&#x5B58;&#x7684;&#x6A21;&#x578B;&#x8FDB;&#x884C;&#x9884;&#x6D4B;&#xFF0C;python&#x7A0B;&#x5E8F;</p>
<pre><code class="lang-python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment"># author:AnFany</span>
<span class="hljs-comment"># datetime:2020/12/11 13:55</span>

<span class="hljs-comment"># &#x5229;&#x7528;&#x521A;&#x4FDD;&#x5B58;&#x7684;&#x6A21;&#x578B;&#x8FDB;&#x884C;&#x56FE;&#x7247;&#x7684;&#x9884;&#x6D4B;</span>

<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf
<span class="hljs-keyword">from</span> object_detection.utils <span class="hljs-keyword">import</span> label_map_util
<span class="hljs-keyword">from</span> object_detection.utils <span class="hljs-keyword">import</span> visualization_utils <span class="hljs-keyword">as</span> viz_utils
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image

<span class="hljs-comment"># &#x6A21;&#x578B;&#x540D;&#x79F0;</span>
Model_Path = <span class="hljs-string">r&apos;E:\odapi_gwt\models\workspace\training_demo_james_kobe\exported-models\Lebron_Kobe_Model&apos;</span>
<span class="hljs-comment"># &#x8F93;&#x5165;&#x56FE;&#x7247;&#x8DEF;&#x5F84;</span>
In_Figure_Path = <span class="hljs-string">r&apos;E:\TF_OD\IN_Figure&apos;</span>
<span class="hljs-comment"># &#x8F93;&#x51FA;&#x56FE;&#x7247;&#x8DEF;&#x5F84;</span>
Out_Figure_Path = <span class="hljs-string">r&apos;E:\TF_OD\Out_Figure&apos;</span>
<span class="hljs-comment"># &#x6807;&#x7B7E;&#x6587;&#x4EF6;</span>
PATH_TO_LABELS = <span class="hljs-string">r&apos;E:\odapi_gwt\models\workspace\training_demo_james_kobe\annotations\label_map.pbtxt&apos;</span>

<span class="hljs-comment"># &#x56FE;&#x7247;&#x683C;&#x5F0F;&#x8F6C;&#x4E3A;&#x6570;&#x7EC4;</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_image_into_numpy_array</span><span class="hljs-params">(path)</span>:</span>
    <span class="hljs-keyword">return</span> np.array(Image.open(path))

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">figure_object_detection</span><span class="hljs-params">(modelp=Model_Path, infigurep=In_Figure_Path, labelsp=PATH_TO_LABELS, outfigure=Out_Figure_Path)</span>:</span>
    <span class="hljs-string">&quot;&quot;&quot;
    &#x5B9E;&#x73B0;&#x56FE;&#x7247;&#x7684;&#x76EE;&#x6807;&#x68C0;&#x6D4B;
    :param modelp: &#x6A21;&#x578B;&#x8DEF;&#x5F84;
    :param infigurep: &#x8F93;&#x5165;&#x56FE;&#x7247;&#x7684;&#x8DEF;&#x5F84;
    :param labelsp: &#x6807;&#x7B7E;&#x8DEF;&#x5F84;
    :param oj: &#x9700;&#x8981;&#x8BC6;&#x522B;&#x51FA;&#x7684;&#x7C7B;&#x522B;
    :return: &#x8BC6;&#x522B;&#x51FA;&#x7684;&#x56FE;&#x7247;&#x5B58;&#x653E;&#x8DEF;&#x5F84;
    &quot;&quot;&quot;</span>
    <span class="hljs-comment"># &#x83B7;&#x53D6;&#x8BC6;&#x522B;&#x7269;&#x4F53;&#x7684;&#x6807;&#x7B7E;&#x5BF9;&#x5E94;&#x5B57;&#x5178;</span>
    category_index = label_map_util.create_category_index_from_labelmap(labelsp, use_display_name=<span class="hljs-keyword">True</span>)

    <span class="hljs-comment"># &#x52A0;&#x8F7D;&#x6A21;&#x578B;</span>
    detect_fn = tf.saved_model.load(modelp + <span class="hljs-string">&quot;/saved_model&quot;</span>)

    <span class="hljs-comment"># &#x56FE;&#x7247;&#x8F6C;&#x6570;&#x7EC4;</span>
    <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> os.listdir(infigurep):
        image_np = load_image_into_numpy_array(<span class="hljs-string">r&apos;%s/%s&apos;</span> %(infigurep, f))
        input_tensor = tf.convert_to_tensor(image_np)
        input_tensor = input_tensor[tf.newaxis, ...]
        detections = detect_fn(input_tensor)
        num_detections = int(detections.pop(<span class="hljs-string">&apos;num_detections&apos;</span>))
        detections = {key: value[<span class="hljs-number">0</span>, :num_detections].numpy() <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> detections.items()}
        detections[<span class="hljs-string">&apos;num_detections&apos;</span>] = num_detections
        detections[<span class="hljs-string">&apos;detection_classes&apos;</span>] = detections[<span class="hljs-string">&apos;detection_classes&apos;</span>].astype(np.int64)
        image_np_with_detections = image_np.copy()
        viz_utils.visualize_boxes_and_labels_on_image_array(
            image_np_with_detections,
            detections[<span class="hljs-string">&apos;detection_boxes&apos;</span>],
            detections[<span class="hljs-string">&apos;detection_classes&apos;</span>],
            detections[<span class="hljs-string">&apos;detection_scores&apos;</span>],
            category_index,
            use_normalized_coordinates=<span class="hljs-keyword">True</span>,
            max_boxes_to_draw=<span class="hljs-number">200</span>,
            min_score_thresh=<span class="hljs-number">.30</span>,
            agnostic_mode=<span class="hljs-keyword">False</span>)
        <span class="hljs-comment"># &#x4FDD;&#x5B58;&#x4E3A;&#x56FE;&#x7247;</span>
        image = Image.fromarray(image_np_with_detections, <span class="hljs-string">&apos;RGB&apos;</span>)
        image.save(<span class="hljs-string">r&apos;%s/%s&apos;</span> % (outfigure, f))

figure_object_detection()
</code></pre>
<footer class="page-footer"><span class="copyright">Copyright &#xA9; AnFany 2020 all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">&#x6700;&#x8FD1;&#x4FEE;&#x8BA2;&#x65F6;&#x95F4;&#xFF1A;
2020-12-30 16:06:57
</span></footer>
<script>console.log("plugin-popup....");document.onclick = function(e){ e.target.tagName === "IMG" && window.open(e.target.src,e.target.src)}</script><style>img{cursor:pointer}</style>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="chapter3.html#332-在线视频" class="navigation navigation-prev " aria-label="Previous page: 3.3.2 在线视频">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="chapter4.html#41-文件结构搭建" class="navigation navigation-next " aria-label="Next page: 4.1 文件结构搭建">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"4 训练目标检测模型","level":"1.5","depth":1,"next":{"title":"4.1 文件结构搭建","level":"1.5.1","depth":2,"anchor":"#41-文件结构搭建","path":"chapter4.md","ref":"chapter4.md#41-文件结构搭建","articles":[]},"previous":{"title":"3.3.2 在线视频","level":"1.4.3.2","depth":3,"anchor":"#332-在线视频","path":"chapter3.md","ref":"chapter3.md#332-在线视频","articles":[]},"dir":"ltr"},"config":{"plugins":["anchors","tbfed-pagefooter","donate","chapter-fold","splitter","back-to-top-button","github@2.0.0","hide-element","code","-sharing","sharing-plus","auto-scroll-table","pageview-count","popup","livereload"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright &copy AnFany 2020","modify_label":"最近修订时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"chapter-fold":{},"github":{"url":"https://github.com/Anfany"},"livereload":{},"splitter":{},"search":{},"sharing-plus":{"qq":false,"all":["facebook","google","twitter","instapaper","linkedin","pocket","stumbleupon"],"douban":false,"facebook":true,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":true,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"auto-scroll-table":{},"popup":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"code":{"copyButtons":true},"donate":{"alipay":"figure/0.0.jpg","alipayText":"支付宝赞助","button":"神来之笔","title":"","wechat":"figure/0.1.jpg","wechatText":"微信赞助"},"hide-element":{"elements":[".gitbook-link"]},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"back-to-top-button":{},"pageview-count":{},"sharing":{"qq":false,"all":["douban","facebook","google","linkedin","twitter","qq","weibo","whatsapp"],"douban":false,"facebook":false,"weibo":false,"whatsapp":false,"twitter":false,"google":false,"linkedin":false},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchors":{}},"theme":"default","author":"AnFany","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Machine Vision CookBook with TensorFlow2","language":"zh-hans","gitbook":"*"},"file":{"path":"chapter4.md","mtime":"2020-12-30T08:06:57.537Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-01-04T03:47:56.624Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-donate/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-chapter-fold/chapter-fold.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-hide-element/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing-plus/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-auto-scroll-table/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-pageview-count/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

