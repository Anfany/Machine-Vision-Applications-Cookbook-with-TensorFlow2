
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>5 人脸识别模型 · Machine Vision CookBook with TensorFlow2</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="AnFany">
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-donate/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-chapter-fold/chapter-fold.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-auto-scroll-table/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-pageview-count/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="chapter5.html" />
    
    
    <link rel="prev" href="chapter4.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./#tensorflow2-object-detection-api-全流程文档">
            
                    
                    序
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="./">
            
                <a href="./#序：无关编码">
            
                    
                    序：无关编码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2" data-path="./">
            
                <a href="./#扫码关注">
            
                    
                    扫码关注
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.3" data-path="./">
            
                <a href="./#联系作者">
            
                    
                    联系作者
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="chapter1.html">
            
                <a href="chapter1.html#1-win10系统tensorflow-gpu22安装">
            
                    
                    1 Win10系统安装TensorFlow-gpu2.2
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="chapter1.html">
            
                <a href="chapter1.html#11-显卡驱动">
            
                    
                    1.1  显卡驱动
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="chapter1.html">
            
                <a href="chapter1.html#111-选择版本">
            
                    
                    1.1.1 选择版本
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" data-path="chapter1.html">
            
                <a href="chapter1.html#112-安装">
            
                    
                    1.1.2 安装
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="chapter1.html">
            
                <a href="chapter1.html#12-cuda工具包">
            
                    
                    1.2 CUDA工具包
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="chapter1.html">
            
                <a href="chapter1.html#121-选择版本">
            
                    
                    1.2.1 选择版本
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="chapter1.html">
            
                <a href="chapter1.html#122-自定义安装">
            
                    
                    1.2.2 自定义安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.3" data-path="chapter1.html">
            
                <a href="chapter1.html#123-添加环境变量">
            
                    
                    1.2.3 添加环境变量
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.4" data-path="chapter1.html">
            
                <a href="chapter1.html#124-验证安装">
            
                    
                    1.2.4 验证安装
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="chapter1.html">
            
                <a href="chapter1.html#13-cudnn">
            
                    
                    1.3 cuDNN
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.1" data-path="chapter1.html">
            
                <a href="chapter1.html#131-选择版本">
            
                    
                    1.3.1 选择版本
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.2" data-path="chapter1.html">
            
                <a href="chapter1.html#132-移动文件">
            
                    
                    1.3.2 移动文件
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="chapter1.html">
            
                <a href="chapter1.html#14-安装anaconda">
            
                    
                    1.4 安装Anaconda
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.4.1" data-path="chapter1.html">
            
                <a href="chapter1.html#141-下载">
            
                    
                    1.4.1 下载
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.2" data-path="chapter1.html">
            
                <a href="chapter1.html#142-验证安装">
            
                    
                    1.4.2 验证安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.3" data-path="chapter1.html">
            
                <a href="chapter1.html#143-conda创建虚拟环境">
            
                    
                    1.4.3 conda创建虚拟环境
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.4" data-path="chapter1.html">
            
                <a href="chapter1.html#144-激活虚拟环境">
            
                    
                    1.4.4 激活虚拟环境
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="chapter1.html">
            
                <a href="chapter1.html#15-运行方式">
            
                    
                    1.5 运行方式
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.5.1" data-path="chapter1.html">
            
                <a href="chapter1.html#151-jupyter-notebook">
            
                    
                    1.5.1 Jupyter Notebook
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.5.1.1" >
            
                <span>
            
                    
                    1.5.1.1 建立python3.8虚拟环境
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.1.2" >
            
                <span>
            
                    
                    1.5.1.2 安装tensorflow-gpu 2.2 版本
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.1.3" >
            
                <span>
            
                    
                    1.5.1.3 安装ipython
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.1.4" >
            
                <span>
            
                    
                    1.5.1.4 安装jupyter notebook
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.1.5" >
            
                <span>
            
                    
                    1.5.1.5 安装ipykernel
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.1.6" >
            
                <span>
            
                    
                    1.5.1.6 更改文件路径
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.1.7" >
            
                <span>
            
                    
                    1.5.1.7 验证安装
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.5.2" data-path="chapter1.html">
            
                <a href="chapter1.html#152-pycharm">
            
                    
                    1.5.2 PyCharm
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.5.2.1" >
            
                <span>
            
                    
                    1.5.2.1 下载社区版本
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.2.2" >
            
                <span>
            
                    
                    1.5.2.2 设置编译器
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.2.3" >
            
                <span>
            
                    
                    1.5.2.3 验证
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.5.3" data-path="chapter1.html">
            
                <a href="chapter1.html#153-错误问题汇集">
            
                    
                    1.5.3 错误问题汇集
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.5.3.1" >
            
                <span>
            
                    
                    1.5.3.1 出现出现.pywrap_tensorflow_internal import错误
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="chapter2.html">
            
                <a href="chapter2.html#2-搭建object-detection环境">
            
                    
                    2 搭建Object Detection环境
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="chapter2.html">
            
                <a href="chapter2.html#21-安装tensorflow模型库">
            
                    
                    2.1 安装TenorFlow模型库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="chapter2.html">
            
                <a href="chapter2.html#22-protobuf安装与编译">
            
                    
                    2.2 Protobuf安装与编译
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="chapter2.html">
            
                <a href="chapter2.html#221-下载protoc">
            
                    
                    2.2.1 下载protoc
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="chapter2.html">
            
                <a href="chapter2.html#222-验证">
            
                    
                    2.2.2 验证
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="chapter2.html">
            
                <a href="chapter2.html#223-编译">
            
                    
                    2.2.3 编译
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="chapter2.html">
            
                <a href="chapter2.html#23-安装coco-api">
            
                    
                    2.3 安装COCO API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.1" data-path="chapter2.html">
            
                <a href="chapter2.html#231-安装cython">
            
                    
                    2.3.1 安装cython
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.2" data-path="chapter2.html">
            
                <a href="chapter2.html#232-下载coco-api压缩包">
            
                    
                    2.3.2 下载coco-api压缩包
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.3" data-path="chapter2.html">
            
                <a href="chapter2.html#233-安装">
            
                    
                    2.3.3 安装
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="chapter2.html">
            
                <a href="chapter2.html#24-安装object-detection-api">
            
                    
                    2.4 安装Object Detection API
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="chapter3.html">
            
                <a href="chapter3.html#3-目标检测模型">
            
                    
                    3 目标检测模型
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="chapter3.html">
            
                <a href="chapter3.html#31-模型下载">
            
                    
                    3.1 模型下载
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1.1" data-path="chapter3.html">
            
                <a href="chapter3.html#311-获取模型信息">
            
                    
                    3.1.1 获取模型信息
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.2" data-path="chapter3.html">
            
                <a href="chapter3.html#312-下载模型">
            
                    
                    3.1.2 下载模型
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="chapter3.html">
            
                <a href="chapter3.html#32-图片目标检测">
            
                    
                    3.2 图片目标检测
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="chapter3.html">
            
                <a href="chapter3.html#33-视频目标检测">
            
                    
                    3.3 视频目标检测
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.3.1" data-path="chapter3.html">
            
                <a href="chapter3.html#331-本地视频">
            
                    
                    3.3.1 本地视频
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3.2" data-path="chapter3.html">
            
                <a href="chapter3.html#332-在线视频">
            
                    
                    3.3.2 在线视频
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="chapter4.html">
            
                <a href="chapter4.html#4-训练目标检测模型">
            
                    
                    4 训练目标检测模型
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="chapter4.html">
            
                <a href="chapter4.html#41-文件结构搭建">
            
                    
                    4.1 文件结构搭建
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="chapter4.html">
            
                <a href="chapter4.html#42-准备数据集">
            
                    
                    4.2 准备数据集
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="chapter4.html">
            
                <a href="chapter4.html#421-数据标注">
            
                    
                    4.2.1 数据标注
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.2" data-path="chapter4.html">
            
                <a href="chapter4.html#422-数据集分割">
            
                    
                    4.2.2 数据集分割
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.3" data-path="chapter4.html">
            
                <a href="chapter4.html#423-创建标签映射">
            
                    
                    4.2.3 创建标签映射
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.4" data-path="chapter4.html">
            
                <a href="chapter4.html#424-转xml为record格式">
            
                    
                    4.2.4 转*.xml为*.record
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="chapter4.html">
            
                <a href="chapter4.html#43-构建训练任务">
            
                    
                    4.3 构建训练任务
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.3.1" data-path="chapter4.html">
            
                <a href="chapter4.html#431-获取预训练模型">
            
                    
                    4.3.1 获取预训练模型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.2" data-path="chapter4.html">
            
                <a href="chapter4.html#432-配置训练管道">
            
                    
                    4.3.2 配置训练管道
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.3.2.1" >
            
                <span>
            
                    
                    4.3.2.1 设置检测对象类的格式
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.2.2" >
            
                <span>
            
                    
                    4.3.2.2 修改批训练大小
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.2.3" >
            
                <span>
            
                    
                    4.3.2.3 模型配置
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.2.4" >
            
                <span>
            
                    
                    4.3.2.4 训练数据集
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.2.5" >
            
                <span>
            
                    
                    4.3.2.5 测试数据集
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3.3" data-path="chapter4.html">
            
                <a href="chapter4.html#433-训练模型">
            
                    
                    4.3.3 训练模型
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.3.3.1" >
            
                <span>
            
                    
                    4.3.3.1 No module named 'lvis'
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.3.2" >
            
                <span>
            
                    
                    4.3.3.2 No module named 'official'
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.3.3" >
            
                <span>
            
                    
                    4.3.3.3 No module named 'yaml'
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.3.4" >
            
                <span>
            
                    
                    4.3.3.4 开始训练
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3.4" data-path="chapter4.html">
            
                <a href="chapter4.html#434-训练过程可视化">
            
                    
                    4.3.4 训练过程可视化
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="chapter4.html">
            
                <a href="chapter4.html#44-评估模型">
            
                    
                    4.4 评估模型
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.4.1" data-path="chapter4.html">
            
                <a href="chapter4.html#441-设置评估标准">
            
                    
                    4.4.1 设置评估标准
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.2" data-path="chapter4.html">
            
                <a href="chapter4.html#442-评估">
            
                    
                    4.4.2 评估
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.3" data-path="chapter4.html">
            
                <a href="chapter4.html#443-评估结果查看">
            
                    
                    4.4.3 评估结果查看
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="chapter4.html">
            
                <a href="chapter4.html#45-模型保存">
            
                    
                    4.5 模型保存
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="chapter4.html">
            
                <a href="chapter4.html#46-模型预测">
            
                    
                    4.6 模型预测
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="chapter5.html">
            
                <a href="chapter5.html#5-人脸识别模型">
            
                    
                    5 人脸识别模型
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="chapter5.html">
            
                <a href="chapter5.html#51-mtcnn">
            
                    
                    5.1 MTCNN
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1.1" data-path="chapter5.html">
            
                <a href="chapter5.html#511-人脸检测">
            
                    
                    5.1.1 人脸检测
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.2" data-path="chapter5.html">
            
                <a href="chapter5.html#512-人脸对齐">
            
                    
                    5.1.2 人脸对齐
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="chapter5.html">
            
                <a href="chapter5.html#52-facenet">
            
                    
                    5.2 FaceNet
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.2.1" data-path="chapter5.html">
            
                <a href="chapter5.html#521-下载facenet源码">
            
                    
                    5.2.1 下载FaceNet源码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.2" data-path="chapter5.html">
            
                <a href="chapter5.html#522-下载预训练模型">
            
                    
                    5.2.2 下载预训练模型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.3" data-path="chapter5.html">
            
                <a href="chapter5.html#523-人脸数据库">
            
                    
                    5.2.3 人脸数据库
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.2.3.1" >
            
                <span>
            
                    
                    5.2.3.1 建立人脸数据库
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.3.2" >
            
                <span>
            
                    
                    5.2.3.2 数据库人脸编码
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.2.4" data-path="chapter5.html">
            
                <a href="chapter5.html#524-人脸编码距离">
            
                    
                    5.2.4 人脸编码距离
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.5" data-path="chapter5.html">
            
                <a href="chapter5.html#525-图片人脸识别">
            
                    
                    5.2.5 图片人脸识别
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.6" data-path="chapter5.html">
            
                <a href="chapter5.html#526-视频人脸识别">
            
                    
                    5.2.6 视频人脸识别
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="chapter6.md">
            
                <span>
            
                    
                    6 目标检测知识备忘
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="chapter7.md">
            
                <span>
            
                    
                    7 附录
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >5 人脸识别模型</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="5-&#x4EBA;&#x8138;&#x8BC6;&#x522B;&#x6A21;&#x578B;"><a name="5-&#x4EBA;&#x8138;&#x8BC6;&#x522B;&#x6A21;&#x578B;" class="plugin-anchor" href="#5-&#x4EBA;&#x8138;&#x8BC6;&#x522B;&#x6A21;&#x578B;"><i class="fa fa-link" aria-hidden="true"></i></a>5 &#x4EBA;&#x8138;&#x8BC6;&#x522B;&#x6A21;&#x578B;</h1>
<p>&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#xFF1A;&#x9996;&#x5148;&#x5229;&#x7528;MTCNN&#x5B9E;&#x73B0;&#x56FE;&#x7247;&#x4E2D;&#x4EBA;&#x8138;&#x7684;&#x68C0;&#x6D4B;&#x5E76;&#x8FDB;&#x884C;&#x5BF9;&#x9F50;&#xFF0C;&#x518D;&#x5229;&#x7528;FaceNet&#x5C06;&#x68C0;&#x6D4B;&#x5230;&#x7684;&#x4EBA;&#x8138;&#x548C;&#x6570;&#x636E;&#x5E93;&#x5B58;&#x50A8;&#x7684;&#x4EBA;&#x8138;&#x8FDB;&#x884C;&#x6BD4;&#x5BF9;&#xFF0C;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x4EBA;&#x8138;&#x8BC6;&#x522B;&#x3002;</p>
<p>&#x672C;&#x7AE0;&#x5B9E;&#x73B0;&#x4EBA;&#x8138;&#x8BC6;&#x522B;&#x7684;&#x5177;&#x4F53;&#x6D41;&#x7A0B;&#xFF1A;</p>
<p><img src="figure/5.14.png" alt=""></p>
<h2 id="51-mtcnn"><a name="51-mtcnn" class="plugin-anchor" href="#51-mtcnn"><i class="fa fa-link" aria-hidden="true"></i></a>5.1 MTCNN</h2>
<p>&#x6FC0;&#x6D3B;&#x865A;&#x62DF;&#x73AF;&#x5883;&#xFF0C;&#x8FD0;&#x884C;pip install mtcnn&#x3002;</p>
<h3 id="511-&#x4EBA;&#x8138;&#x68C0;&#x6D4B;"><a name="511-&#x4EBA;&#x8138;&#x68C0;&#x6D4B;" class="plugin-anchor" href="#511-&#x4EBA;&#x8138;&#x68C0;&#x6D4B;"><i class="fa fa-link" aria-hidden="true"></i></a>5.1.1 &#x4EBA;&#x8138;&#x68C0;&#x6D4B;</h3>
<p>&#x4E0B;&#x9762;&#x662F;MTCNN&#x9488;&#x5BF9;&#x68C0;&#x6D4B;&#x5230;&#x7684;&#x4E00;&#x4E2A;&#x4EBA;&#x8138;&#x7684;&#x8F93;&#x51FA;&#x3002;&#x5728;&#x8F93;&#x51FA;&#x4EBA;&#x8138;&#x6846;&#x5750;&#x6807;&#x7684;&#x540C;&#x65F6;&#xFF0C;&#x4E5F;&#x4F1A;&#x8F93;&#x51FA;&#x4E24;&#x53EA;&#x773C;&#x775B;&#xFF0C;&#x9F3B;&#x5B50;&#x548C;&#x5634;&#x5DF4;&#x7684;&#x5DE6;&#x3001;&#x53F3;&#x4E94;&#x4E2A;&#x5173;&#x952E;&#x70B9;&#x7684;&#x50CF;&#x7D20;&#x5750;&#x6807;&#xFF1A;</p>
<pre><code class="lang-python">{<span class="hljs-string">&apos;box&apos;</span>: [<span class="hljs-number">711</span>, <span class="hljs-number">205</span>, <span class="hljs-number">202</span>, <span class="hljs-number">180</span>], <span class="hljs-string">&apos;confidence&apos;</span>: <span class="hljs-number">0.9637635946273804</span>, <span class="hljs-string">&apos;keypoints&apos;</span>: {<span class="hljs-string">&apos;left_eye&apos;</span>: (<span class="hljs-number">823</span>, <span class="hljs-number">274</span>), <span class="hljs-string">&apos;right_eye&apos;</span>: (<span class="hljs-number">834</span>, <span class="hljs-number">327</span>), <span class="hljs-string">&apos;nose&apos;</span>: (<span class="hljs-number">795</span>, <span class="hljs-number">300</span>), <span class="hljs-string">&apos;mouth_left&apos;</span>: (<span class="hljs-number">762</span>, <span class="hljs-number">293</span>), <span class="hljs-string">&apos;mouth_right&apos;</span>: (<span class="hljs-number">767</span>, <span class="hljs-number">337</span>)}}
</code></pre>
<p>python&#x7A0B;&#x5E8F;</p>
<pre><code class="lang-python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment"># author:AnFany</span>
<span class="hljs-comment"># datetime:2020/12/24 17:40</span>

<span class="hljs-comment"># &#x5229;&#x7528;mtcnn&#x5B9E;&#x73B0;&#x56FE;&#x7247;&#x4E2D;&#x4EBA;&#x8138;&#x7684;&#x68C0;&#x6D4B;</span>

<span class="hljs-keyword">from</span> mtcnn.mtcnn <span class="hljs-keyword">import</span> MTCNN
<span class="hljs-keyword">import</span> cv2
<span class="hljs-keyword">import</span> os

<span class="hljs-comment"># &#x8F93;&#x5165;&#x56FE;&#x7247;&#x8DEF;&#x5F84;</span>
IN_Figure_Path = <span class="hljs-string">r&apos;C:\Users\Administrator\Desktop\mtcnn_figure\mtcnn_in&apos;</span>

<span class="hljs-comment"># &#x8F93;&#x51FA;&#x56FE;&#x7247;&#x8DEF;&#x5F84;</span>
OUT_Figure_Path = <span class="hljs-string">r&apos;C:\Users\Administrator\Desktop\mtcnn_figure\mtcnn_out&apos;</span>

<span class="hljs-comment"># &#x8FDB;&#x884C;&#x4EBA;&#x8138;&#x68C0;&#x6D4B;&#x7684;&#x51FD;&#x6570;</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">mtcnn_face_detection</span><span class="hljs-params">(inp=IN_Figure_Path, outp=OUT_Figure_Path, boxcolor=<span class="hljs-params">(<span class="hljs-number">220</span>, <span class="hljs-number">20</span>, <span class="hljs-number">20</span>)</span>,
                         keypointcolor=<span class="hljs-params">(<span class="hljs-number">20</span>, <span class="hljs-number">220</span>, <span class="hljs-number">20</span>)</span>,boxw=<span class="hljs-number">3</span>)</span>:</span>
    <span class="hljs-string">&quot;&quot;&quot;
    :param inp: &#x9700;&#x8981;&#x8FDB;&#x884C;&#x4EBA;&#x8138;&#x68C0;&#x6D4B;&#x7684;&#x56FE;&#x7247;&#x7684;&#x8DEF;&#x5F84;
    :param outp: &#x68C0;&#x6D4B;&#x540E;&#x7684;&#x8F93;&#x51FA;&#x8DEF;&#x5F84;
    :param boxcolor: (255,0,0) &#x5BF9;&#x5E94;rgb&#xFF0C;&#x68C0;&#x6D4B;&#x6846;&#x7684;&#x989C;&#x8272;
    :param keypointcolor: (255,0,0) &#x5BF9;&#x5E94;rgb&#xFF0C;&#x68C0;&#x6D4B;&#x6846;&#x7684;&#x989C;&#x8272;
    :param boxw: &#x68C0;&#x6D4B;&#x6846;&#x7684;&#x5BBD;&#x5EA6;
    :return: &#x5E26;&#x6709;&#x68C0;&#x6D4B;&#x6846;&#x7684;&#x56FE;&#x7247;
    &quot;&quot;&quot;</span>
    <span class="hljs-comment"># &#x4EBA;&#x8138;&#x68C0;&#x6D4B;&#x6A21;&#x578B;</span>
    detector = MTCNN()
    <span class="hljs-keyword">for</span> fig <span class="hljs-keyword">in</span> os.listdir(inp):
        <span class="hljs-comment"># &#x56E0;&#x4E3A;cv2&#x8BFB;&#x53D6;&#x7684;&#x56FE;&#x7247;&#x6570;&#x636E;&#x662F;bgr&#x7684;&#xFF0C;&#x6A21;&#x578B;&#x7684;&#x8F93;&#x5165;&#x662F;rgb&#x7684;</span>
        img_data = cv2.cvtColor(cv2.imread(<span class="hljs-string">r&apos;%s/%s&apos;</span> %(inp, fig)), cv2.COLOR_BGR2RGB)
        <span class="hljs-comment"># &#x68C0;&#x6D4B;&#x7ED3;&#x679C;</span>
        result_detection =  detector.detect_faces(img_data)
        <span class="hljs-comment"># &#x5224;&#x65AD;&#x662F;&#x5426;&#x68C0;&#x6D4B;&#x51FA;&#x4EBA;&#x8138;</span>
        <span class="hljs-keyword">if</span> result_detection:
            <span class="hljs-keyword">for</span> face <span class="hljs-keyword">in</span> result_detection:
                <span class="hljs-comment"># &#x83B7;&#x53D6;&#x6846;&#x7684;&#x50CF;&#x7D20;&#x5750;&#x6807;</span>
                minx, miny, width, height = face[<span class="hljs-string">&apos;box&apos;</span>]
                maxx, maxy = minx+width, miny + height
                <span class="hljs-comment"># &#x52A0;&#x4E0A;&#x4EBA;&#x8138;&#x6846;</span>
                face_data = cv2.rectangle(img_data, (minx, miny), (maxx, maxy), boxcolor, boxw)
                <span class="hljs-comment"># &#x52A0;&#x4E0A;&#x4E94;&#x5173;&#x952E;&#x70B9;</span>
                <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> [<span class="hljs-string">&apos;left_eye&apos;</span>, <span class="hljs-string">&apos;right_eye&apos;</span>, <span class="hljs-string">&apos;nose&apos;</span>, <span class="hljs-string">&apos;mouth_left&apos;</span>, <span class="hljs-string">&apos;mouth_right&apos;</span>]:
                    face_data = cv2.circle(face_data, face[<span class="hljs-string">&apos;keypoints&apos;</span>][k], radius=<span class="hljs-number">0</span>,
                                           color=keypointcolor, thickness=boxw*<span class="hljs-number">2</span>)
                <span class="hljs-comment"># &#x6570;&#x636E;&#x901A;&#x9053;&#x5728;&#x53D8;&#x56DE;&#x53BB;</span>
                face_data = cv2.cvtColor(face_data, cv2.COLOR_RGB2BGR)
            <span class="hljs-comment"># &#x4FDD;&#x5B58;&#x56FE;&#x7247;</span>
            name = <span class="hljs-string">&apos;&apos;</span>.join(fig.split(<span class="hljs-string">&apos;.&apos;</span>)[:<span class="hljs-number">-1</span>])
            cv2.imwrite(<span class="hljs-string">r&apos;%s/%s.png&apos;</span> % (outp, name), face_data, [int(cv2.IMWRITE_JPEG_QUALITY), <span class="hljs-number">100</span>])
    <span class="hljs-keyword">return</span> print(<span class="hljs-string">&apos;&#x4EBA;&#x8138;&#x68C0;&#x6D4B;&#x5B8C;&#x6BD5;&apos;</span>)

mtcnn_face_detection()
</code></pre>
<p>&#x793A;&#x56FE;&#xFF1A;</p>
<p><img src="figure/5.7.jpg" alt=""></p>
<p><img src="figure/5.8.png" alt=""></p>
<h3 id="512-&#x4EBA;&#x8138;&#x5BF9;&#x9F50;"><a name="512-&#x4EBA;&#x8138;&#x5BF9;&#x9F50;" class="plugin-anchor" href="#512-&#x4EBA;&#x8138;&#x5BF9;&#x9F50;"><i class="fa fa-link" aria-hidden="true"></i></a>5.1.2 &#x4EBA;&#x8138;&#x5BF9;&#x9F50;</h3>
<p>&#x6FC0;&#x6D3B;&#x865A;&#x62DF;&#x73AF;&#x5883;&#xFF0C;&#x8FD0;&#x884C;&#x547D;&#x4EE4;pip install scikit-image&#x3002;&#x9700;&#x8981;&#x6839;&#x636E;&#x4E94;&#x4E2A;&#x5173;&#x952E;&#x70B9;&#x7684;&#x50CF;&#x7D20;&#x5750;&#x6807;&#xFF0C;&#x4EE5;&#x53CA;&#x6807;&#x51C6;&#x6B63;&#x8138;&#x5404;&#x4E2A;&#x5173;&#x952E;&#x70B9;&#x7684;&#x5750;&#x6807;&#x8BA1;&#x7B97;&#x4EFF;&#x5C04;&#x53D8;&#x6362;&#x7684;&#x77E9;&#x9635;&#xFF0C;&#x7136;&#x540E;&#x5BF9;&#x56FE;&#x7247;&#x8FDB;&#x884C;&#x88C1;&#x526A;&#xFF0C;&#x5F97;&#x5230;&quot;&#x6B63;&#x8138;&quot;&#x3002;</p>
<p>python&#x7A0B;&#x5E8F;</p>
<pre><code class="lang-python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment"># author:AnFany</span>
<span class="hljs-comment"># datetime:2020/12/28 10:03</span>

<span class="hljs-comment"># &#x5728;&#x4EBA;&#x8138;&#x8BC6;&#x522B;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x5C06;&#x8F93;&#x51FA;&#x7684;&#x4EBA;&#x8138;&#x8FDB;&#x884C;&#x5BF9;&#x9F50;&#x6821;&#x6B63;</span>

<span class="hljs-keyword">from</span> mtcnn.mtcnn <span class="hljs-keyword">import</span> MTCNN
<span class="hljs-keyword">import</span> cv2
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">from</span> skimage <span class="hljs-keyword">import</span> transform <span class="hljs-keyword">as</span> trans


<span class="hljs-comment"># &#x8F93;&#x5165;&#x56FE;&#x7247;&#x8DEF;&#x5F84;</span>
IN_Figure_Path = <span class="hljs-string">r&apos;C:\Users\Administrator\Desktop\mtcnn_figure\mtcnn_in&apos;</span>

<span class="hljs-comment"># &#x8F93;&#x51FA;&#x56FE;&#x7247;&#x8DEF;&#x5F84;</span>
OUT_Figure_Path = <span class="hljs-string">r&apos;C:\Users\Administrator\Desktop\mtcnn_figure\mtcnn_out&apos;</span>

<span class="hljs-comment"># &#x6B63;&#x8138;&#x6309;&#x7167;112*112&#x7684;&#x5C3A;&#x5BF8;&#xFF0C;&#x6B64;&#x65F6;&#x5DE6;&#x773C;&#x3001;&#x53F3;&#x773C;&#x3001;&#x9F3B;&#x5B50;&#x3001;&#x5634;&#x5DF4;&#x5DE6;&#x8FB9;&#x3001;&#x53F3;&#x8FB9;&#x7684;&#x5750;&#x6807;&#x4E3A;</span>
KeyPoints = np.array([(<span class="hljs-number">38.2946</span>, <span class="hljs-number">51.6963</span>),
                      (<span class="hljs-number">73.5318</span>, <span class="hljs-number">51.6963</span>),
                      (<span class="hljs-number">56.0252</span>, <span class="hljs-number">71.7366</span>),
                      (<span class="hljs-number">41.5493</span>, <span class="hljs-number">92.3655</span>),
                      (<span class="hljs-number">70.7299</span>, <span class="hljs-number">92.3655</span>)])

<span class="hljs-comment"># &#x8FDB;&#x884C;&#x4EBA;&#x8138;&#x68C0;&#x6D4B;&#x7684;&#x51FD;&#x6570;</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">mtcnn_face_detection_align</span><span class="hljs-params">(inp=IN_Figure_Path, outp=OUT_Figure_Path,
                               boxcolor=<span class="hljs-params">(<span class="hljs-number">220</span>, <span class="hljs-number">20</span>, <span class="hljs-number">20</span>)</span>, boxw=<span class="hljs-number">3</span>, dst_data=KeyPoints, figsize=<span class="hljs-params">(<span class="hljs-number">112</span>, <span class="hljs-number">112</span>)</span>)</span>:</span>
    <span class="hljs-string">&quot;&quot;&quot;
    :param inp: &#x9700;&#x8981;&#x8FDB;&#x884C;&#x4EBA;&#x8138;&#x68C0;&#x6D4B;&#x7684;&#x56FE;&#x7247;&#x7684;&#x8DEF;&#x5F84;
    :param outp: &#x68C0;&#x6D4B;&#x540E;&#x7684;&#x8F93;&#x51FA;&#x8DEF;&#x5F84;
    :param boxcolor: (220, 20, 20) &#x5BF9;&#x5E94;rgb&#xFF0C;&#x68C0;&#x6D4B;&#x6846;&#x7684;&#x989C;&#x8272;
    :param boxw: &#x68C0;&#x6D4B;&#x6846;&#x7684;&#x5BBD;&#x5EA6;
    :param dst_data: 112*112 &#x7684;&#x6B63;&#x8138;&#x4E2D;&#x5173;&#x952E;&#x70B9;&#x7684;&#x5750;&#x6807;
    :param figsize: &#x56FE;&#x7247;&#x5C3A;&#x5BF8;112*112
    :return: &#x4EBA;&#x8138;&#x5BF9;&#x9F50;&#x540E;&#x7684;&#x56FE;&#x7247;
    &quot;&quot;&quot;</span>
    <span class="hljs-comment"># &#x4EBA;&#x8138;&#x68C0;&#x6D4B;&#x6A21;&#x578B;</span>
    detector = MTCNN()
    <span class="hljs-keyword">for</span> fig <span class="hljs-keyword">in</span> os.listdir(inp):
        <span class="hljs-comment"># &#x56E0;&#x4E3A;cv2&#x8BFB;&#x53D6;&#x7684;&#x56FE;&#x7247;&#x6570;&#x636E;&#x662F;bgr&#x7684;&#xFF0C;&#x6A21;&#x578B;&#x7684;&#x8F93;&#x5165;&#x662F;rgb&#x7684;</span>
        img_data = cv2.cvtColor(cv2.imread(<span class="hljs-string">r&apos;%s/%s&apos;</span> %(inp, fig)), cv2.COLOR_BGR2RGB)
        <span class="hljs-comment"># &#x68C0;&#x6D4B;&#x7ED3;&#x679C;</span>
        result_detection =  detector.detect_faces(img_data)
        <span class="hljs-comment"># &#x5224;&#x65AD;&#x662F;&#x5426;&#x68C0;&#x6D4B;&#x51FA;&#x4EBA;&#x8138;</span>
        name = <span class="hljs-string">&apos;&apos;</span>.join(fig.split(<span class="hljs-string">&apos;.&apos;</span>)[:<span class="hljs-number">-1</span>])
        <span class="hljs-keyword">if</span> result_detection:
            face_count = <span class="hljs-number">1</span> <span class="hljs-comment"># &#x4EBA;&#x8138;&#x6570;&#x91CF;</span>
            face_set = []
            <span class="hljs-keyword">for</span> face <span class="hljs-keyword">in</span> result_detection:
                <span class="hljs-comment"># &#x83B7;&#x53D6;&#x6846;&#x7684;&#x50CF;&#x7D20;&#x5750;&#x6807;</span>
                minx, miny, width, height = face[<span class="hljs-string">&apos;box&apos;</span>]
                maxx, maxy = minx+width, miny + height
                <span class="hljs-comment"># &#x4FDD;&#x5B58;&#x4EBA;&#x8138;&#x6846;</span>
                face_set.append([[minx, miny], [maxx, maxy]])
                <span class="hljs-comment"># &#x5C06;&#x68C0;&#x6D4B;&#x5230;&#x7684;&#x4EBA;&#x8138;&#x56FE;&#x7247;&#x622A;&#x53D6;&#x4E0B;&#x6765;</span>
                face_detection_data = img_data[miny:maxy,minx:maxx, :]
                face_detection_data = cv2.cvtColor(face_detection_data, cv2.COLOR_RGB2BGR)
                <span class="hljs-comment"># &#x4FDD;&#x5B58;&#x622A;&#x53D6;&#x5230;&#x7684;&#x4EBA;&#x8138;</span>
                cv2.imwrite(<span class="hljs-string">r&apos;%s/%s_%s.png&apos;</span> % (outp, name, face_count), face_detection_data, [int(cv2.IMWRITE_JPEG_QUALITY), <span class="hljs-number">100</span>])

                <span class="hljs-comment"># &#x83B7;&#x5F97;&#x4E94;&#x4E2A;&#x5173;&#x952E;&#x70B9;&#x7684;&#x5750;&#x6807;</span>
                src_data = []
                <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> [<span class="hljs-string">&apos;left_eye&apos;</span>,<span class="hljs-string">&apos;right_eye&apos;</span>,<span class="hljs-string">&apos;nose&apos;</span>,<span class="hljs-string">&apos;mouth_left&apos;</span>,<span class="hljs-string">&apos;mouth_right&apos;</span>]:
                    src_data.append(face[<span class="hljs-string">&apos;keypoints&apos;</span>][k])

                <span class="hljs-comment"># &#x8BA1;&#x7B97;&#x653E;&#x5C04;&#x77E9;&#x9635;</span>
                tform = trans.SimilarityTransform()
                res = tform.estimate(np.array(src_data), dst_data)
                M = tform.params
                <span class="hljs-comment"># &#x5E94;&#x7528;&#x4EFF;&#x5C04;&#x77E9;&#x9635;&#x8FDB;&#x884C;&#x4EBA;&#x8138;&#x5BF9;&#x9F50;</span>
                align_face_data =  cv2.warpAffine(img_data.copy(), M[:<span class="hljs-number">2</span>,:], figsize,
                                                  flags=cv2.INTER_CUBIC, borderValue=(<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>))
                align_face_data = cv2.cvtColor(align_face_data, cv2.COLOR_RGB2BGR)
                cv2.imwrite(<span class="hljs-string">r&apos;%s/%s_%s_align.png&apos;</span> % (outp, name, face_count), align_face_data,
                            [int(cv2.IMWRITE_JPEG_QUALITY), <span class="hljs-number">100</span>])
                face_count += <span class="hljs-number">1</span>

            <span class="hljs-keyword">for</span> fb <span class="hljs-keyword">in</span> face_set:
                <span class="hljs-comment"># &#x52A0;&#x4E0A;&#x4EBA;&#x8138;&#x6846;</span>
                face_data = cv2.rectangle(img_data, tuple(fb[<span class="hljs-number">0</span>]), tuple(fb[<span class="hljs-number">1</span>]), boxcolor, boxw)
            <span class="hljs-comment"># &#x6570;&#x636E;&#x901A;&#x9053;&#x5728;&#x53D8;&#x56DE;&#x53BB;</span>
            face_data = cv2.cvtColor(face_data, cv2.COLOR_RGB2BGR)
            <span class="hljs-comment"># &#x4FDD;&#x5B58;&#x5E26;&#x6709;&#x4EBA;&#x8138;&#x6846;&#x7684;&#x56FE;&#x7247;</span>
            cv2.imwrite(<span class="hljs-string">r&apos;%s/%s.png&apos;</span> % (outp, name), face_data, [int(cv2.IMWRITE_JPEG_QUALITY), <span class="hljs-number">100</span>])

    <span class="hljs-keyword">return</span> print(<span class="hljs-string">&apos;&#x4EBA;&#x8138;&#x68C0;&#x6D4B;&#x5B8C;&#x6BD5;&apos;</span>)

mtcnn_face_detection_align()
</code></pre>
<p>&#x622A;&#x53D6;&#x5230;&#x7684;&#x4EBA;&#x8138;</p>
<p><img src="figure/5.91.png" alt=""></p>
<p>&#x5BF9;&#x9F50;&#x540E;&#xFF1A;</p>
<p><img src="figure/5.92.png" alt=""></p>
<p>&#x622A;&#x53D6;&#x5230;&#x7684;&#x4EBA;&#x8138;</p>
<p><img src="figure/5.93.png" alt=""></p>
<p>&#x5BF9;&#x9F50;&#x540E;</p>
<p><img src="figure/5.94.png" alt=""></p>
<h2 id="52-facenet"><a name="52-facenet" class="plugin-anchor" href="#52-facenet"><i class="fa fa-link" aria-hidden="true"></i></a>5.2 FaceNet</h2>
<h3 id="521-&#x4E0B;&#x8F7D;facenet&#x6E90;&#x7801;"><a name="521-&#x4E0B;&#x8F7D;facenet&#x6E90;&#x7801;" class="plugin-anchor" href="#521-&#x4E0B;&#x8F7D;facenet&#x6E90;&#x7801;"><i class="fa fa-link" aria-hidden="true"></i></a>5.2.1 &#x4E0B;&#x8F7D;FaceNet&#x6E90;&#x7801;</h3>
<p>&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x5728;&#x8BE5;&#x6587;&#x4EF6;&#x5939;&#x5185;&#x70B9;&#x51FB;Git Bash Here&#xFF0C;&#x8FD0;&#x884C; git clone <a href="https://github.com/davidsandberg/facenet.git" target="_blank">https://github.com/davidsandberg/facenet.git</a>&#x3002;</p>
<p>&#x5982;&#x679C;&#x4E0B;&#x8F7D;&#x5931;&#x8D25;&#xFF0C;&#x53EF;&#x4EE5;&#x591A;&#x8BD5;&#x8BD5;&#x51E0;&#x6B21;&#x3002;</p>
<p><img src="figure/5.2.png" alt=""></p>
<p>&#x6210;&#x529F;&#x540E;&#xFF0C;&#x5C06;&#x65B0;&#x751F;&#x6210;&#x7684;&#x6587;&#x4EF6;&#x5939;facenet&#xFF0C;</p>
<p><img src="figure/5.4.jpg" alt=""></p>
<p>&#x79FB;&#x52A8;&#x5230;&#x865A;&#x62DF;&#x73AF;&#x5883;&#x5B89;&#x88C5;&#x7684;&#x5305;&#x7684;&#x8DEF;&#x5F84;&#x4E2D;&#xFF1A;</p>
<p><img src="figure/5.3.png" alt=""></p>
<p>&#x9A8C;&#x8BC1;</p>
<pre><code class="lang-python">

</code></pre>
<p>&#x51FA;&#x73B0;&#x9519;&#x8BEF;</p>
<p><img src="figure/5.6.png" alt=""></p>
<p>&#x6FC0;&#x6D3B;&#x865A;&#x62DF;&#x73AF;&#x5883;&#xFF0C;&#x8FD0;&#x884C;pip install scikit-learn</p>
<p><img src="figure/5.5.png" alt=""></p>
<h3 id="522-&#x4E0B;&#x8F7D;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;"><a name="522-&#x4E0B;&#x8F7D;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;" class="plugin-anchor" href="#522-&#x4E0B;&#x8F7D;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;"><i class="fa fa-link" aria-hidden="true"></i></a>5.2.2 &#x4E0B;&#x8F7D;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;</h3>
<p>&#x6A21;&#x578B;&#x7F51;&#x5740;<a href="https://github.com/davidsandberg/facenet&#xFF0C;" target="_blank">https://github.com/davidsandberg/facenet&#xFF0C;</a></p>
<p><img src="figure/5.10.png" alt=""></p>
<p>&#x56E0;&#x4E3A;&#x6A21;&#x578B;&#x5728;&#x8C37;&#x6B4C;&#x4E91;&#x76D8;&#x4E0A;&#xFF0C;&#x9700;&#x8981;&#x7FFB;&#x5899;&#x4E0B;&#x8F7D;&#xFF0C;&#x4E0B;&#x9762;&#x7ED9;&#x51FA;&#x4E24;&#x4E2A;&#x6A21;&#x578B;&#x7684;&#x767E;&#x5EA6;&#x7F51;&#x76D8;&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#xFF1A;</p>
<ul>
<li>20180408-102900 </li>
</ul>
<p>&#x94FE;&#x63A5;&#xFF1A;<a href="https://pan.baidu.com/s/1fLKmJojLo8U8TLnREncxIw" target="_blank">https://pan.baidu.com/s/1fLKmJojLo8U8TLnREncxIw</a> 
&#x63D0;&#x53D6;&#x7801;&#xFF1A;1whr </p>
<ul>
<li>20180402-114759</li>
</ul>
<p>&#x94FE;&#x63A5;&#xFF1A;<a href="https://pan.baidu.com/s/1QbwbDnVHfbIPZgM3mVlhKA" target="_blank">https://pan.baidu.com/s/1QbwbDnVHfbIPZgM3mVlhKA</a> 
&#x63D0;&#x53D6;&#x7801;&#xFF1A;y7fr </p>
<h3 id="523-&#x4EBA;&#x8138;&#x6570;&#x636E;&#x5E93;"><a name="523-&#x4EBA;&#x8138;&#x6570;&#x636E;&#x5E93;" class="plugin-anchor" href="#523-&#x4EBA;&#x8138;&#x6570;&#x636E;&#x5E93;"><i class="fa fa-link" aria-hidden="true"></i></a>5.2.3 &#x4EBA;&#x8138;&#x6570;&#x636E;&#x5E93;</h3>
<p>&#x5C06;&#x5BF9;&#x9F50;&#x540E;&#x7684;&#x56FE;&#x7247;&#x8F93;&#x5165;&#x5230;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;&#x4E2D;&#xFF0C;&#x83B7;&#x5F97;&#x6A21;&#x578B;&#x8F93;&#x51FA;&#x7684;512&#x7EF4;&#x5411;&#x91CF;&#xFF0C;&#x5728;&#x8BA1;&#x7B97;&#x5411;&#x91CF;&#x4E4B;&#x95F4;&#x7684;&#x76F8;&#x4F3C;&#x5EA6;(&#x6B27;&#x5F0F;&#x8DDD;&#x79BB;&#x548C;&#x4F59;&#x5F26;&#x76F8;&#x4F3C;)&#x3002;</p>
<h4 id="5231-&#x5EFA;&#x7ACB;&#x4EBA;&#x8138;&#x6570;&#x636E;&#x5E93;"><a name="5231-&#x5EFA;&#x7ACB;&#x4EBA;&#x8138;&#x6570;&#x636E;&#x5E93;" class="plugin-anchor" href="#5231-&#x5EFA;&#x7ACB;&#x4EBA;&#x8138;&#x6570;&#x636E;&#x5E93;"><i class="fa fa-link" aria-hidden="true"></i></a>5.2.3.1 &#x5EFA;&#x7ACB;&#x4EBA;&#x8138;&#x6570;&#x636E;&#x5E93;</h4>
<p>&#x6536;&#x96C6;&#x9700;&#x8981;&#x8BC6;&#x522B;&#x7684;&#x4EBA;&#x7684;3-5&#x5F20;&#x4E0D;&#x540C;&#x89D2;&#x5EA6;&#x7684;&#x56FE;&#x7247;&#xFF0C;&#x4F5C;&#x4E3A;&#x4EBA;&#x8138;&#x6570;&#x636E;&#x5E93;&#x7684;&#x539F;&#x59CB;&#x56FE;&#x7247;&#x3002;&#x6839;&#x636E;&#x539F;&#x59CB;&#x56FE;&#x7247;&#x5EFA;&#x7ACB;&#x4EBA;&#x8138;&#x56FE;&#x7247;&#x6570;&#x636E;&#x3002;</p>
<p>python&#x7A0B;&#x5E8F;</p>
<pre><code class="lang-python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment"># author:AnFany</span>
<span class="hljs-comment"># datetime:2020/12/30 13:44</span>


<span class="hljs-comment"># &#x6839;&#x636E;&#x4EBA;&#x8138;&#x6570;&#x636E;&#x5E93;&#x539F;&#x59CB;&#x56FE;&#x7247;&#x5B58;&#x50A8;&#x7684;&#x6BCF;&#x4E2A;&#x4EBA;&#x7684;&#x7167;&#x7247;&#xFF0C;&#x5EFA;&#x7ACB;&#x4EBA;&#x8138;&#x56FE;&#x7247;&#x6570;&#x636E;</span>
<span class="hljs-keyword">from</span> mtcnn.mtcnn <span class="hljs-keyword">import</span> MTCNN
<span class="hljs-keyword">import</span> cv2
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">from</span> skimage <span class="hljs-keyword">import</span> transform <span class="hljs-keyword">as</span> trans
<span class="hljs-keyword">import</span> shutil

<span class="hljs-comment"># &#x4EBA;&#x8138;&#x6570;&#x636E;&#x5E93;&#x8DEF;&#x5F84;</span>
DataBase_Figure_Path = <span class="hljs-string">r&apos;E:\facenet_database&apos;</span>
<span class="hljs-comment"># &#x5B58;&#x653E;&#x6BCF;&#x4E2A;&#x4EBA;&#x7684;&#x539F;&#x59CB;&#x56FE;&#x7247;&#x6587;&#x4EF6;&#x5939;</span>
Origin_Name = <span class="hljs-string">&apos;origin_fig&apos;</span>

<span class="hljs-comment"># &#x4E0D;&#x540C;&#x5C3A;&#x5BF8;&#x4E0B;&#x4EBA;&#x8138;&#x5DE6;&#x773C;&#x3001;&#x53F3;&#x773C;&#x3001;&#x9F3B;&#x5B50;&#x3001;&#x5DE6;&#x5634;&#x89D2;&#x3001;&#x53F3;&#x5634;&#x89D2;&#x7684;&#x5750;&#x6807;&#x7684;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;</span>
Size_KeyPoints = {<span class="hljs-string">&apos;1&apos;</span>: [(<span class="hljs-number">112</span>, <span class="hljs-number">112</span>), np.array([(<span class="hljs-number">38.2946</span>, <span class="hljs-number">51.6963</span>),
                                              (<span class="hljs-number">73.5318</span>, <span class="hljs-number">51.6963</span>),
                                              (<span class="hljs-number">56.0252</span>, <span class="hljs-number">71.7366</span>),
                                              (<span class="hljs-number">41.5493</span>, <span class="hljs-number">92.3655</span>),
                                              (<span class="hljs-number">70.7299</span>, <span class="hljs-number">92.3655</span>)])],
                  <span class="hljs-string">&apos;2&apos;</span>: [(<span class="hljs-number">96</span>, <span class="hljs-number">96</span>), np.array([(<span class="hljs-number">30.2946</span>, <span class="hljs-number">43.6963</span>),
                                            (<span class="hljs-number">65.5318</span>, <span class="hljs-number">43.6963</span>),
                                            (<span class="hljs-number">48.0252</span>, <span class="hljs-number">63.7366</span>),
                                            (<span class="hljs-number">33.5493</span>, <span class="hljs-number">84.3655</span>),
                                            (<span class="hljs-number">62.7299</span>, <span class="hljs-number">84.3655</span>)])]}

<span class="hljs-comment"># &#x5EFA;&#x7ACB;&#x6BCF;&#x4E2A;&#x4EBA;&#x7684;&#x4EBA;&#x8138;&#x56FE;&#x7247;</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_face_person_database</span><span class="hljs-params">(inp=DataBase_Figure_Path, oname=Origin_Name, dst_data=Size_KeyPoints)</span>:</span>
    <span class="hljs-comment"># &#x9996;&#x5148;&#x5EFA;&#x7ACB;&#x4EBA;&#x8138;&#x6587;&#x4EF6;&#x5939;</span>
    face_path = os.path.join(inp, <span class="hljs-string">&apos;face_fig&apos;</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-string">&apos;face_fig&apos;</span> <span class="hljs-keyword">in</span> os.listdir(inp):
        shutil.rmtree(face_path)
        os.mkdir(face_path)
    <span class="hljs-keyword">else</span>:
        os.mkdir(face_path)

    <span class="hljs-comment"># &#x4EBA;&#x8138;&#x68C0;&#x6D4B;&#x6A21;&#x578B;</span>
    detector = MTCNN()

    <span class="hljs-comment"># &#x5F00;&#x59CB;&#x904D;&#x5386;&#x539F;&#x59CB;&#x56FE;&#x7247;</span>
    originfigpath = os.path.join(inp, oname)
    <span class="hljs-comment"># &#x904D;&#x5386;&#x6BCF;&#x4E2A;&#x4EBA;&#x7684;&#x6587;&#x4EF6;&#x5939;</span>
    <span class="hljs-keyword">for</span> fol <span class="hljs-keyword">in</span> os.listdir(originfigpath):
        <span class="hljs-comment"># &#x65B0;&#x5EFA;&#x6587;&#x4EF6;&#x5939;</span>
        new_face_path = os.path.join(face_path, fol)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(new_face_path):
            os.mkdir(new_face_path)
        <span class="hljs-comment"># &#x904D;&#x5386;&#x6BCF;&#x4E2A;&#x56FE;&#x7247;</span>
        person_file = os.path.join(originfigpath, fol)
        <span class="hljs-keyword">for</span> per <span class="hljs-keyword">in</span> os.listdir(person_file):
            fig_path = os.path.join(person_file, per)
            <span class="hljs-comment"># &#x4EBA;&#x8138;&#x68C0;&#x6D4B;&#x6A21;&#x578B;</span>
            <span class="hljs-comment"># &#x56E0;&#x4E3A;cv2&#x8BFB;&#x53D6;&#x7684;&#x56FE;&#x7247;&#x6570;&#x636E;&#x662F;bgr&#x7684;&#xFF0C;&#x6A21;&#x578B;&#x7684;&#x8F93;&#x5165;&#x662F;rgb&#x7684;</span>
            img_data = cv2.cvtColor(cv2.imread(fig_path), cv2.COLOR_BGR2RGB)
            <span class="hljs-comment"># &#x68C0;&#x6D4B;&#x7ED3;&#x679C;</span>
            result_detection = detector.detect_faces(img_data)
            <span class="hljs-comment"># &#x5224;&#x65AD;&#x662F;&#x5426;&#x68C0;&#x6D4B;&#x51FA;&#x4EBA;&#x8138;</span>
            name = <span class="hljs-string">&apos;&apos;</span>.join(per.split(<span class="hljs-string">&apos;.&apos;</span>)[:<span class="hljs-number">-1</span>])
            <span class="hljs-keyword">if</span> result_detection:
                face_count = <span class="hljs-number">1</span> <span class="hljs-comment"># &#x4EBA;&#x8138;&#x6570;&#x91CF;</span>
                face_set = []
                <span class="hljs-keyword">for</span> face <span class="hljs-keyword">in</span> result_detection:
                    <span class="hljs-comment"># &#x83B7;&#x53D6;&#x6846;&#x7684;&#x50CF;&#x7D20;&#x5750;&#x6807;</span>
                    minx, miny, width, height = face[<span class="hljs-string">&apos;box&apos;</span>]
                    maxx, maxy = minx+width, miny + height
                    <span class="hljs-comment"># &#x4FDD;&#x5B58;&#x4EBA;&#x8138;&#x6846;</span>
                    face_set.append([[minx, miny], [maxx, maxy]])
                    <span class="hljs-comment"># &#x5C06;&#x68C0;&#x6D4B;&#x5230;&#x7684;&#x4EBA;&#x8138;&#x56FE;&#x7247;&#x622A;&#x53D6;&#x4E0B;&#x6765;</span>
                    face_detection_data = img_data[miny:maxy,minx:maxx, :]
                    face_detection_data = cv2.cvtColor(face_detection_data, cv2.COLOR_RGB2BGR)

                    <span class="hljs-comment"># &#x83B7;&#x5F97;&#x4E94;&#x4E2A;&#x5173;&#x952E;&#x70B9;&#x7684;&#x5750;&#x6807;</span>
                    src_data = []
                    <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> [<span class="hljs-string">&apos;left_eye&apos;</span>,<span class="hljs-string">&apos;right_eye&apos;</span>,<span class="hljs-string">&apos;nose&apos;</span>,<span class="hljs-string">&apos;mouth_left&apos;</span>,<span class="hljs-string">&apos;mouth_right&apos;</span>]:
                        src_data.append(face[<span class="hljs-string">&apos;keypoints&apos;</span>][k])

                    <span class="hljs-comment"># &#x8BA1;&#x7B97;&#x653E;&#x5C04;&#x77E9;&#x9635;</span>
                    tform = trans.SimilarityTransform()
                    <span class="hljs-comment"># &#x904D;&#x5386;&#x4E0D;&#x540C;&#x7684;&#x6B63;&#x8138;&#x5C3A;&#x5BF8;</span>
                    <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> dst_data:
                        fsize, kdata = dst_data[d]
                        res = tform.estimate(np.array(src_data), kdata)
                        M = tform.params
                        <span class="hljs-comment"># &#x5E94;&#x7528;&#x4EFF;&#x5C04;&#x77E9;&#x9635;&#x8FDB;&#x884C;&#x4EBA;&#x8138;&#x5BF9;&#x9F50;</span>
                        align_face_data =  cv2.warpAffine(img_data.copy(), M[:<span class="hljs-number">2</span>,:], fsize,
                                                          flags=cv2.INTER_CUBIC, borderValue=(<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>))
                        <span class="hljs-comment"># &#x8F6C;&#x5316;&#x901A;&#x9053;</span>
                        align_face_data = cv2.cvtColor(align_face_data, cv2.COLOR_RGB2BGR)
                        <span class="hljs-comment"># &#x4FDD;&#x5B58;&#x56FE;&#x7247;</span>
                        cv2.imwrite(<span class="hljs-string">r&apos;%s/%s_%s_%s_%s.png&apos;</span> % (new_face_path, d, fol, face_count,name), align_face_data,
                                    [int(cv2.IMWRITE_JPEG_QUALITY), <span class="hljs-number">100</span>])
                    face_count += <span class="hljs-number">1</span>

    <span class="hljs-keyword">return</span> print(<span class="hljs-string">&apos;&#x4EBA;&#x8138;&#x6570;&#x636E;&#x5E93;&#x751F;&#x6210;&#x5B8C;&#x6BD5;&apos;</span>)

build_face_person_database()
</code></pre>
<p>&#x5EFA;&#x6210;&#x7684;&#x4EBA;&#x8138;&#x6570;&#x636E;&#x5E93;&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x5305;&#x62EC;&#x539F;&#x59CB;&#x56FE;&#x7247;&#x548C;&#x4EBA;&#x8138;&#x56FE;&#x7247;&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x5E76;&#x4E14;&#x6BCF;&#x4E2A;&#x6587;&#x4EF6;&#x5939;&#x5747;&#x5305;&#x62EC;&#x6BCF;&#x4E2A;&#x4EBA;&#x7167;&#x7247;&#x7684;&#x72EC;&#x7ACB;&#x6587;&#x4EF6;&#x5939;&#x3002;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;</p>
<p><img src="figure/5.11.png" alt=""></p>
<h4 id="5232-&#x6570;&#x636E;&#x5E93;&#x4EBA;&#x8138;&#x7F16;&#x7801;"><a name="5232-&#x6570;&#x636E;&#x5E93;&#x4EBA;&#x8138;&#x7F16;&#x7801;" class="plugin-anchor" href="#5232-&#x6570;&#x636E;&#x5E93;&#x4EBA;&#x8138;&#x7F16;&#x7801;"><i class="fa fa-link" aria-hidden="true"></i></a>5.2.3.2 &#x6570;&#x636E;&#x5E93;&#x4EBA;&#x8138;&#x7F16;&#x7801;</h4>
<p>&#x5BF9;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x4EBA;&#x8138;&#x8FDB;&#x884C;&#x7F16;&#x7801;&#x5E76;&#x5B58;&#x4E3A;json&#x6587;&#x4EF6;&#xFF0C;json&#x6587;&#x4EF6;&#x683C;&#x5F0F;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="figure/5.12.png" alt=""></p>
<p>python&#x7A0B;&#x5E8F;</p>
<pre><code class="lang-python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment"># author:AnFany</span>
<span class="hljs-comment"># datetime:2020/12/30 14:38</span>

<span class="hljs-comment"># &#x5BF9;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x4EBA;&#x8138;&#x8FDB;&#x884C;&#x7F16;&#x7801;&#x5E76;&#x5B58;&#x4E3A;jason&#x6587;&#x4EF6;</span>
<span class="hljs-comment"># facenet&#x662F;&#x57FA;&#x4E8E;tensorflow1.x&#x7248;&#x672C;&#x7684;</span>

<span class="hljs-keyword">import</span> tensorflow.compat.v1 <span class="hljs-keyword">as</span> tf
tf.disable_v2_behavior()

<span class="hljs-keyword">import</span> facenet.src.facenet <span class="hljs-keyword">as</span> facenet
<span class="hljs-keyword">import</span> cv2
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> json

<span class="hljs-comment"># &#x4EBA;&#x8138;&#x56FE;&#x7247;&#x6587;&#x4EF6;&#x5939;</span>
FaceFigPath = <span class="hljs-string">r&apos;E:\facenet_database\face_fig&apos;</span>
<span class="hljs-comment"># &#x5B58;&#x50A8;&#x4EBA;&#x8138;&#x56FE;&#x7247;&#x7F16;&#x7801;json&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x8DEF;&#x7ECF;</span>
JsonPath = <span class="hljs-string">r&apos;E:\facenet_database&apos;</span>

<span class="hljs-comment"># &#x5C3A;&#x5BF8;&#x914D;&#x7F6E;</span>
ImageSize = [<span class="hljs-number">140</span>, <span class="hljs-number">169</span>]  <span class="hljs-comment"># &#x9700;&#x8981;&#x9002;&#x5408;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;&#xFF0C;&#x672C;&#x6587;&#x6A21;&#x578B;&#x9002;&#x5408;[139-170]&#x3002;</span>
<span class="hljs-comment"># &#x4E0B;&#x8F7D;&#x597D;&#x7684;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;</span>
PreTrainModelDir = <span class="hljs-string">r&apos;E:\facenet_model\20180408-102900\20180408-102900.pb&apos;</span>

<span class="hljs-comment"># &#x4EBA;&#x8138;&#x6570;&#x636E;&#x7F16;&#x7801;&#x51FD;&#x6570;</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_face_db_code</span><span class="hljs-params">(inp=FaceFigPath, imlist=ImageSize, md=PreTrainModelDir, jp=JsonPath)</span>:</span>
    face_code_dict = {}
    <span class="hljs-keyword">with</span> tf.Graph().as_default():
        sess = tf.Session()
        <span class="hljs-keyword">with</span> sess.as_default():
            <span class="hljs-comment"># &#x4E0B;&#x8F7D;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;&#x53C2;&#x6570;</span>
            facenet.load_model(md)
            <span class="hljs-comment"># &#x6839;&#x636E;&#x540D;&#x79F0;&#x83B7;&#x53D6;&#x76F8;&#x5E94;&#x7684;&#x5F20;&#x91CF;</span>
            image_input_tensor = tf.get_default_graph().get_tensor_by_name(<span class="hljs-string">&quot;input:0&quot;</span>)
            embeddings_tensor = tf.get_default_graph().get_tensor_by_name(<span class="hljs-string">&quot;embeddings:0&quot;</span>)
            phase_train_tensor = tf.get_default_graph().get_tensor_by_name(<span class="hljs-string">&quot;phase_train:0&quot;</span>)

            <span class="hljs-comment"># &#x5F00;&#x59CB;&#x904D;&#x5386;&#x6BCF;&#x4E2A;&#x4EBA;&#x7684;</span>
            <span class="hljs-keyword">for</span> per_fold <span class="hljs-keyword">in</span> os.listdir(inp):
                face_code_dict[per_fold] = {}
                per_fold_path = os.path.join(inp, per_fold)
                <span class="hljs-keyword">for</span> per_fig <span class="hljs-keyword">in</span> os.listdir(per_fold_path):
                    per_fig_path = os.path.join(per_fold_path, per_fig)
                    <span class="hljs-comment"># &#x8BFB;&#x53D6;&#x56FE;&#x7247;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x8F6C;&#x6362;&#x901A;&#x9053;</span>
                    image_data = cv2.cvtColor(cv2.imread(per_fig_path), cv2.COLOR_BGR2RGB)
                    <span class="hljs-comment"># &#x6B63;&#x8138;&#x5C3A;&#x5BF8;&#x7F16;&#x53F7;</span>
                    right_face_sign = per_fig.split(<span class="hljs-string">&apos;_&apos;</span>)[<span class="hljs-number">0</span>]
                    <span class="hljs-comment"># &#x4E0D;&#x540C;&#x7684;&#x5C3A;&#x5BF8;</span>
                    <span class="hljs-keyword">for</span> fs <span class="hljs-keyword">in</span> imlist:
                        <span class="hljs-keyword">if</span> fs <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> face_code_dict[per_fold]:
                            face_code_dict[per_fold][fs] = {}
                        image_data2 = cv2.resize(image_data, (fs, fs), interpolation=cv2.INTER_CUBIC)
                        <span class="hljs-comment"># &#x56FE;&#x7247;&#x6570;&#x636E;&#x9884;&#x5904;&#x7406;</span>
                        image_data2 = facenet.prewhiten(image_data2)
                        <span class="hljs-comment"># &#x6570;&#x636E;&#x589E;&#x52A0;&#x7EF4;&#x5EA6;</span>
                        image_data2 = image_data2.reshape(<span class="hljs-number">-1</span>,fs,fs,<span class="hljs-number">3</span>)
                        <span class="hljs-comment"># &#x7F16;&#x7801;&#x6570;&#x636E;&#xFF0C;&#x957F;&#x5EA6;&#x4E3A;512</span>
                        embeddings_data = sess.run(embeddings_tensor,
                                                   feed_dict={image_input_tensor: image_data2,
                                                              phase_train_tensor: <span class="hljs-keyword">False</span>})[<span class="hljs-number">0</span>].tolist()
                        <span class="hljs-keyword">if</span> right_face_sign <span class="hljs-keyword">in</span> face_code_dict[per_fold][fs]:
                            face_code_dict[per_fold][fs][right_face_sign].append(embeddings_data)
                        <span class="hljs-keyword">else</span>:
                            face_code_dict[per_fold][fs][right_face_sign] = [embeddings_data]


    <span class="hljs-comment"># &#x5C06;&#x5B57;&#x5178;&#x53D8;&#x4E3A;json</span>
    jsonstr = json.dumps(face_code_dict)
    <span class="hljs-comment"># &#x5B58;&#x50A8;</span>
    <span class="hljs-keyword">with</span> open(<span class="hljs-string">r&apos;%s/em_face_json.json&apos;</span> % jp, <span class="hljs-string">&apos;w&apos;</span>) <span class="hljs-keyword">as</span> j:
        j.write(jsonstr)

    <span class="hljs-keyword">return</span> print(<span class="hljs-string">&apos;&#x4EBA;&#x8138;&#x56FE;&#x7247;&#x7F16;&#x7801;json&#x4FDD;&#x5B58;&#x5B8C;&#x6BD5;&apos;</span>)

get_face_db_code()
</code></pre>
<h3 id="524-&#x4EBA;&#x8138;&#x7F16;&#x7801;&#x8DDD;&#x79BB;"><a name="524-&#x4EBA;&#x8138;&#x7F16;&#x7801;&#x8DDD;&#x79BB;" class="plugin-anchor" href="#524-&#x4EBA;&#x8138;&#x7F16;&#x7801;&#x8DDD;&#x79BB;"><i class="fa fa-link" aria-hidden="true"></i></a>5.2.4 &#x4EBA;&#x8138;&#x7F16;&#x7801;&#x8DDD;&#x79BB;</h3>
<p><img src="figure/5.20.png" alt=""></p>
<p>python&#x7A0B;&#x5E8F;&#x4E3A;</p>
<pre><code class="lang-python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment"># author:AnFany</span>
<span class="hljs-comment"># datetime:2020/12/30 16:51</span>

<span class="hljs-comment"># &#x8BA1;&#x7B97;&#x5411;&#x91CF;&#x4E4B;&#x95F4;&#x7684;&#x8DDD;&#x79BB;</span>

<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compare_dis_em</span><span class="hljs-params">(em1, em2, mode=<span class="hljs-string">&apos;euler&apos;</span>)</span>:</span>
    em1 = np.array(em1)
    em2 = np.array(em2)
    <span class="hljs-keyword">if</span> mode == <span class="hljs-string">&apos;euler&apos;</span>:
        <span class="hljs-comment"># &#x6B27;&#x5F0F;&#x8DDD;&#x79BB;</span>
        diff = np.subtract(em1, em2)
        dist = np.sum(np.square(diff), <span class="hljs-number">1</span>)
    <span class="hljs-keyword">elif</span> mode == <span class="hljs-string">&apos;cos&apos;</span>:
        <span class="hljs-comment"># &#x57FA;&#x4E8E;&#x4F59;&#x5F26;&#x76F8;&#x4F3C;&#x5EA6;&#x7684;&#x8DDD;&#x79BB;</span>
        dot = np.sum(np.multiply(em1, em2), axis=<span class="hljs-number">1</span>)
        norm = np.linalg.norm(em1, axis=<span class="hljs-number">1</span>) * np.linalg.norm(em2, axis=<span class="hljs-number">1</span>)
        sim = dot / norm
        dist = np.arccos(sim) / np.pi
    <span class="hljs-keyword">return</span> dist
</code></pre>
<h3 id="525-&#x56FE;&#x7247;&#x4EBA;&#x8138;&#x8BC6;&#x522B;"><a name="525-&#x56FE;&#x7247;&#x4EBA;&#x8138;&#x8BC6;&#x522B;" class="plugin-anchor" href="#525-&#x56FE;&#x7247;&#x4EBA;&#x8138;&#x8BC6;&#x522B;"><i class="fa fa-link" aria-hidden="true"></i></a>5.2.5 &#x56FE;&#x7247;&#x4EBA;&#x8138;&#x8BC6;&#x522B;</h3>
<p>&#x6839;&#x636E;&#x81EA;&#x5B9A;&#x4E49;&#x9608;&#x503C;&#xFF0C;&#x5B9E;&#x73B0;&#x56FE;&#x7247;&#x4E0A;&#x4EBA;&#x8138;&#x7684;&#x8BC6;&#x522B;&#xFF0C;&#x5E76;&#x5728;&#x56FE;&#x7247;&#x4E0A;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x6807;&#x6CE8;&#xFF0C;&#x672A;&#x8BC6;&#x522B;&#x7684;&#x6807;&#x6CE8;&quot;unKnown&quot;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment"># author:AnFany</span>
<span class="hljs-comment"># datetime:2020/12/30 17:05</span>

<span class="hljs-comment"># &#x5B9E;&#x73B0;&#x56FE;&#x7247;&#x7684;&#x4EBA;&#x8138;&#x8BC6;&#x522B;&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x6807;&#x6CE8;</span>

<span class="hljs-comment"># &#x7B2C;&#x4E00;&#x6B65;&#x9AA4;&#xFF1A;&#x4EBA;&#x8138;&#x68C0;&#x6D4B;&#x548C;&#x5BF9;&#x9F50;</span>
<span class="hljs-keyword">from</span> mtcnn.mtcnn <span class="hljs-keyword">import</span> MTCNN
<span class="hljs-keyword">import</span> cv2
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">from</span> skimage <span class="hljs-keyword">import</span> transform <span class="hljs-keyword">as</span> trans
<span class="hljs-keyword">import</span> shutil

<span class="hljs-comment"># &#x7B2C;&#x4E8C;&#x6B65;&#x9AA4;&#xFF1A;&#x4EBA;&#x8138;&#x7F16;&#x7801;</span>
<span class="hljs-keyword">import</span> tensorflow.compat.v1 <span class="hljs-keyword">as</span> tf
tf.disable_v2_behavior()
<span class="hljs-keyword">import</span> facenet.src.facenet <span class="hljs-keyword">as</span> facenet
<span class="hljs-keyword">import</span> json

<span class="hljs-comment"># &#x7B2C;&#x4E09;&#x6B65;&#x9AA4;&#xFF1A;&#x4EBA;&#x8138;&#x8BC6;&#x522B;</span>
<span class="hljs-comment"># &#x8BA1;&#x7B97;&#x8DDD;&#x79BB;</span>
<span class="hljs-keyword">import</span> computer_distance_em <span class="hljs-keyword">as</span> cde

<span class="hljs-comment"># &#x5F85;&#x8BC6;&#x522B;&#x7684;&#x4EBA;&#x8138;&#x56FE;&#x7247;&#x6587;&#x4EF6;&#x5939;</span>
FaceFigPath = <span class="hljs-string">r&apos;C:\Users\Administrator\Desktop\mtcnn_figure\mtcnn_in&apos;</span>
<span class="hljs-comment"># &#x8F93;&#x51FA;&#x4EBA;&#x8138;&#x56FE;&#x7247;&#x6587;&#x4EF6;&#x5939;</span>
OutFigPath = <span class="hljs-string">r&apos;C:\Users\Administrator\Desktop\mtcnn_figure\mtcnn_out&apos;</span>
<span class="hljs-comment"># &#x6570;&#x636E;&#x5E93;&#x4EBA;&#x8138;&#x56FE;&#x7247;&#x7F16;&#x7801;json&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x8DEF;&#x7ECF;</span>
JsonPath = <span class="hljs-string">r&apos;E:\facenet_database\em_face_json.json&apos;</span>

<span class="hljs-comment"># &#x5C3A;&#x5BF8;&#x914D;&#x7F6E;</span>
ImageSize = <span class="hljs-number">169</span> <span class="hljs-comment"># &#x6700;&#x597D;&#x548C;&#x6570;&#x636E;&#x5E93;&#x5B58;&#x50A8;&#x7684;&#x4E00;&#x6837;</span>
<span class="hljs-comment"># &#x6B63;&#x8138;&#x5173;&#x952E;&#x70B9;</span>
Size_KeyPoints = {<span class="hljs-string">&apos;1&apos;</span>: [(<span class="hljs-number">112</span>, <span class="hljs-number">112</span>), np.array([(<span class="hljs-number">38.2946</span>, <span class="hljs-number">51.6963</span>),
                                              (<span class="hljs-number">73.5318</span>, <span class="hljs-number">51.6963</span>),
                                              (<span class="hljs-number">56.0252</span>, <span class="hljs-number">71.7366</span>),
                                              (<span class="hljs-number">41.5493</span>, <span class="hljs-number">92.3655</span>),
                                              (<span class="hljs-number">70.7299</span>, <span class="hljs-number">92.3655</span>)])]}
<span class="hljs-comment"># &#x4E0B;&#x8F7D;&#x597D;&#x7684;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;</span>
PreTrainModelDir = <span class="hljs-string">r&apos;E:\facenet_model\20180408-102900\20180408-102900.pb&apos;</span>
<span class="hljs-comment"># &#x9608;&#x503C;</span>
Threshold = <span class="hljs-number">0.5</span>  <span class="hljs-comment"># &#x8DDD;&#x79BB;&#x5C0F;&#x4E8E;&#x9608;&#x503C;&#x5C31;&#x89C6;&#x4E3A;&#x662F;&#x4E00;&#x4E2A;&#x4EBA;</span>

<span class="hljs-comment"># &#x964C;&#x751F;&#x4EBA;&#x6807;&#x6CE8;</span>
Strname = <span class="hljs-string">&apos;unKnown&apos;</span>

KN=<span class="hljs-string">&apos;1&apos;</span>

<span class="hljs-comment"># &#x56FE;&#x7247;&#x6570;&#x636E;&#x6807;&#x6CE8;&#x51FD;&#x6570;</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_tip</span><span class="hljs-params">(figuredata, boxdata, txt, boxcolor=<span class="hljs-params">(<span class="hljs-number">220</span>, <span class="hljs-number">20</span>, <span class="hljs-number">20</span>)</span>, boxw=<span class="hljs-number">2</span>, txtcolor=<span class="hljs-params">(<span class="hljs-number">20</span>, <span class="hljs-number">220</span>, <span class="hljs-number">20</span>)</span>)</span>:</span>
    <span class="hljs-comment"># &#x6807;&#x6CE8;&#x4EBA;&#x8138;&#x6846;</span>
    box_data = cv2.rectangle(figuredata, boxdata[<span class="hljs-number">0</span>], boxdata[<span class="hljs-number">1</span>], boxcolor, boxw)
    <span class="hljs-comment"># &#x6DFB;&#x52A0;&#x6587;&#x5B57;</span>
    font = cv2.FONT_HERSHEY_COMPLEX
    x, y = boxdata[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>], boxdata[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]
    txt_data = cv2.putText(box_data, txt, (x, y), font, fontScale=<span class="hljs-number">0.6</span>, color=txtcolor, thickness=<span class="hljs-number">1</span>)
    <span class="hljs-keyword">return</span> txt_data


<span class="hljs-comment"># &#x4EBA;&#x8138;&#x8BC6;&#x522B;</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">face_figure_iden</span><span class="hljs-params">(inp=FaceFigPath, oup=OutFigPath, fs=ImageSize,
                     md=PreTrainModelDir, jp=JsonPath, tn=Threshold, keyn=KN,
                     rfs=Size_KeyPoints[KN][<span class="hljs-number">0</span>], dstdata=Size_KeyPoints[KN][<span class="hljs-number">1</span>], sn=Strname)</span>:</span>
    <span class="hljs-comment"># &#x83B7;&#x53D6;&#x6570;&#x636E;&#x5E93;&#x7F16;&#x7801;</span>
    <span class="hljs-keyword">with</span> open(jp, <span class="hljs-string">&apos;r&apos;</span>) <span class="hljs-keyword">as</span> g:
        json_str = g.read()
    face_code_dict = dict(json.loads(json_str))
    <span class="hljs-comment"># &#x4EBA;&#x8138;&#x68C0;&#x6D4B;&#x6A21;&#x578B;</span>
    detector = MTCNN()
    <span class="hljs-comment"># &#x4EBA;&#x8138;&#x7F16;&#x7801;&#x6A21;&#x578B;</span>
    sess = tf.Session()
    <span class="hljs-comment"># &#x4E0B;&#x8F7D;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;&#x53C2;&#x6570;</span>
    facenet.load_model(md)
    <span class="hljs-comment"># &#x6839;&#x636E;&#x540D;&#x79F0;&#x83B7;&#x53D6;&#x76F8;&#x5E94;&#x7684;&#x5F20;&#x91CF;</span>
    image_input_tensor = tf.get_default_graph().get_tensor_by_name(<span class="hljs-string">&quot;input:0&quot;</span>)
    embeddings_tensor = tf.get_default_graph().get_tensor_by_name(<span class="hljs-string">&quot;embeddings:0&quot;</span>)
    phase_train_tensor = tf.get_default_graph().get_tensor_by_name(<span class="hljs-string">&quot;phase_train:0&quot;</span>)
    <span class="hljs-comment"># &#x5F00;&#x59CB;&#x904D;&#x5386;&#x6BCF;&#x4E2A;&#x56FE;&#x7247;</span>
    <span class="hljs-keyword">for</span> per_fig <span class="hljs-keyword">in</span> os.listdir(inp):
        per_fig_path = os.path.join(inp, per_fig)
        <span class="hljs-comment"># &#x8BFB;&#x53D6;&#x56FE;&#x7247;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x8F6C;&#x6362;&#x901A;&#x9053;</span>
        image_data = cv2.cvtColor(cv2.imread(per_fig_path), cv2.COLOR_BGR2RGB)
        result_detection = detector.detect_faces(image_data)
        <span class="hljs-comment"># &#x5B58;&#x50A8;&#x8BC6;&#x522B;&#x5230;&#x7684;&#x4EBA;&#x8138;</span>
        face_set_signed = {}
        <span class="hljs-comment"># &#x6CA1;&#x6709;&#x8BC6;&#x522B;&#x5230;&#x7684;&#x4EBA;&#x8138;</span>
        fce_set_nosign = {}
        fce_set_nosign[sn] = []
        <span class="hljs-comment"># &#x5224;&#x65AD;&#x662F;&#x5426;&#x68C0;&#x6D4B;&#x51FA;&#x4EBA;&#x8138;</span>
        <span class="hljs-keyword">if</span> result_detection:
            <span class="hljs-comment"># &#x904D;&#x5386;&#x83B7;&#x53D6;&#x5230;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x8138;</span>
            <span class="hljs-keyword">for</span> face <span class="hljs-keyword">in</span> result_detection:
                <span class="hljs-comment"># &#x83B7;&#x53D6;&#x6846;&#x7684;&#x50CF;&#x7D20;&#x5750;&#x6807;</span>
                minx, miny, width, height = face[<span class="hljs-string">&apos;box&apos;</span>]
                maxx, maxy = minx + width, miny + height
                <span class="hljs-comment"># &#x5C06;&#x68C0;&#x6D4B;&#x5230;&#x7684;&#x4EBA;&#x8138;&#x56FE;&#x7247;&#x622A;&#x53D6;&#x4E0B;&#x6765;</span>
                face_detection_data = image_data[miny:maxy, minx:maxx, :]
                face_detection_data = cv2.cvtColor(face_detection_data, cv2.COLOR_RGB2BGR)
                <span class="hljs-comment"># &#x83B7;&#x5F97;&#x4E94;&#x4E2A;&#x5173;&#x952E;&#x70B9;&#x7684;&#x5750;&#x6807;</span>
                src_data = []
                <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> [<span class="hljs-string">&apos;left_eye&apos;</span>, <span class="hljs-string">&apos;right_eye&apos;</span>, <span class="hljs-string">&apos;nose&apos;</span>, <span class="hljs-string">&apos;mouth_left&apos;</span>, <span class="hljs-string">&apos;mouth_right&apos;</span>]:
                    src_data.append(face[<span class="hljs-string">&apos;keypoints&apos;</span>][k])
                <span class="hljs-comment"># &#x8BA1;&#x7B97;&#x4EFF;&#x5C04;&#x77E9;&#x9635;</span>
                tform = trans.SimilarityTransform()
                res = tform.estimate(np.array(src_data), dstdata)
                M = tform.params
                <span class="hljs-comment"># &#x5E94;&#x7528;&#x4EFF;&#x5C04;&#x77E9;&#x9635;&#x8FDB;&#x884C;&#x4EBA;&#x8138;&#x5BF9;&#x9F50;</span>
                align_face_data = cv2.warpAffine(image_data.copy(), M[:<span class="hljs-number">2</span>, :], rfs,
                                                 flags=cv2.INTER_CUBIC, borderValue=(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>))
                <span class="hljs-comment"># &#x8FDB;&#x5165;&#x4EBA;&#x8138;&#x7F16;&#x7801;&#x6A21;&#x578B;</span>
                code_face_data = cv2.resize(align_face_data, (fs, fs), interpolation=cv2.INTER_CUBIC)
                <span class="hljs-comment"># &#x56FE;&#x7247;&#x6570;&#x636E;&#x9884;&#x5904;&#x7406;</span>
                code_face_data = facenet.prewhiten(code_face_data)
                <span class="hljs-comment"># &#x6570;&#x636E;&#x589E;&#x52A0;&#x7EF4;&#x5EA6;</span>
                code_face_data = code_face_data.reshape(<span class="hljs-number">-1</span>, fs, fs, <span class="hljs-number">3</span>)
                <span class="hljs-comment"># &#x7F16;&#x7801;&#x6570;&#x636E;&#xFF0C;&#x957F;&#x5EA6;&#x4E3A;512</span>
                embeddings_data = sess.run(embeddings_tensor,
                                           feed_dict={image_input_tensor: code_face_data,
                                                      phase_train_tensor: <span class="hljs-keyword">False</span>})[<span class="hljs-number">0</span>].tolist()
                <span class="hljs-comment"># &#x5F00;&#x59CB;&#x904D;&#x5386;&#x6570;&#x636E;&#x5E93;&#x7F16;&#x7801;</span>
                person_dict = {}
                <span class="hljs-keyword">for</span> person <span class="hljs-keyword">in</span> face_code_dict:
                    code_list = face_code_dict[person][str(fs)][keyn]
                    all_dis = []
                    <span class="hljs-keyword">for</span> pco <span class="hljs-keyword">in</span> code_list:
                        all_dis.append(cde.compare_dis_em(embeddings_data, pco))
                    <span class="hljs-comment"># &#x8BA1;&#x7B97;&#x5747;&#x503C;</span>
                    person_dict[person] = sum(all_dis) / len(code_list)
                <span class="hljs-comment"># &#x6240;&#x6709;&#x7684;&#x5747;&#x503C;&#x90FD;&#x4E0D;&#x5C0F;&#x4E8E;&#x9608;&#x503C;&#xFF0C;&#x5219;&#x4E3A;&#x964C;&#x751F;&#x4EBA;&#xFF0C;&#x5426;&#x5219;&#x9009;&#x62E9;&#x6700;&#x5C0F;&#x7684;&#x4F5C;&#x4E3A;&#x8EAB;&#x4EFD;</span>
                min_dis = sorted(person_dict.items(), key=<span class="hljs-keyword">lambda</span> s:s[<span class="hljs-number">1</span>])[<span class="hljs-number">0</span>]
                print(min_dis)
                <span class="hljs-keyword">if</span> min_dis[<span class="hljs-number">1</span>] &gt; tn:
                    <span class="hljs-comment"># &#x964C;&#x751F;&#x4EBA;</span>
                    fce_set_nosign[sn].append([(minx, miny), (maxx, maxy)])
                <span class="hljs-keyword">else</span>:
                    face_set_signed[min_dis[<span class="hljs-number">0</span>]] = [(minx, miny), (maxx, maxy)]
        <span class="hljs-comment"># &#x5F00;&#x59CB;&#x8FDB;&#x884C;&#x6807;&#x6CE8;</span>
        image_data = cv2.cvtColor(image_data, cv2.COLOR_RGB2BGR)
        <span class="hljs-keyword">if</span> fce_set_nosign[sn]:
            <span class="hljs-keyword">for</span> data_f <span class="hljs-keyword">in</span> fce_set_nosign[sn]:
                image_data = plot_tip(image_data, data_f, sn)
        <span class="hljs-keyword">if</span> face_set_signed:
            <span class="hljs-keyword">for</span> fkey <span class="hljs-keyword">in</span> face_set_signed:
                image_data = plot_tip(image_data, face_set_signed[fkey], fkey)
        <span class="hljs-comment"># &#x4FDD;&#x5B58;&#x4E3A;&#x56FE;&#x7247;</span>
        cv2.imwrite(<span class="hljs-string">r&apos;%s/%s.png&apos;</span> % (oup, per_fig), image_data, [int(cv2.IMWRITE_JPEG_QUALITY), <span class="hljs-number">100</span>])

    <span class="hljs-keyword">return</span> print(<span class="hljs-string">&apos;&#x56FE;&#x7247;&#x4EBA;&#x8138;&#x8BC6;&#x522B;&#x5B8C;&#x6BD5;&apos;</span>)

face_figure_iden()
</code></pre>
<p><img src="figure/5.13.png" alt=""></p>
<h3 id="526-&#x89C6;&#x9891;&#x4EBA;&#x8138;&#x8BC6;&#x522B;"><a name="526-&#x89C6;&#x9891;&#x4EBA;&#x8138;&#x8BC6;&#x522B;" class="plugin-anchor" href="#526-&#x89C6;&#x9891;&#x4EBA;&#x8138;&#x8BC6;&#x522B;"><i class="fa fa-link" aria-hidden="true"></i></a>5.2.6 &#x89C6;&#x9891;&#x4EBA;&#x8138;&#x8BC6;&#x522B;</h3>
<pre><code class="lang-python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment"># author:AnFany</span>
<span class="hljs-comment"># datetime:2021/1/4 9:46</span>


<span class="hljs-comment"># &#x5B9E;&#x73B0;&#x5728;&#x7EBF;&#x89C6;&#x9891;&#x7684;&#x4EBA;&#x8138;&#x68C0;&#x6D4B;&#x5E76;&#x6807;&#x6CE8;</span>

<span class="hljs-comment"># &#x7B2C;&#x4E00;&#x6B65;&#x9AA4;&#xFF1A;&#x4EBA;&#x8138;&#x68C0;&#x6D4B;&#x548C;&#x5BF9;&#x9F50;</span>
<span class="hljs-keyword">from</span> mtcnn.mtcnn <span class="hljs-keyword">import</span> MTCNN
<span class="hljs-keyword">import</span> cv2
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">from</span> skimage <span class="hljs-keyword">import</span> transform <span class="hljs-keyword">as</span> trans
<span class="hljs-keyword">import</span> shutil

<span class="hljs-comment"># &#x7B2C;&#x4E8C;&#x6B65;&#x9AA4;&#xFF1A;&#x4EBA;&#x8138;&#x7F16;&#x7801;</span>
<span class="hljs-keyword">import</span> tensorflow.compat.v1 <span class="hljs-keyword">as</span> tf
tf.disable_v2_behavior()
<span class="hljs-keyword">import</span> facenet.src.facenet <span class="hljs-keyword">as</span> facenet
<span class="hljs-keyword">import</span> json

<span class="hljs-comment"># &#x7B2C;&#x4E09;&#x6B65;&#x9AA4;&#xFF1A;&#x4EBA;&#x8138;&#x8BC6;&#x522B;</span>
<span class="hljs-comment"># &#x8BA1;&#x7B97;&#x8DDD;&#x79BB;</span>
<span class="hljs-keyword">import</span> computer_distance_em <span class="hljs-keyword">as</span> cde

<span class="hljs-comment"># &#x6570;&#x636E;&#x5E93;&#x4EBA;&#x8138;&#x56FE;&#x7247;&#x7F16;&#x7801;json&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x8DEF;&#x7ECF;</span>
JsonPath = <span class="hljs-string">r&apos;E:\facenet_database\em_face_json.json&apos;</span>
<span class="hljs-comment"># &#x5C3A;&#x5BF8;&#x914D;&#x7F6E;</span>
ImageSize = <span class="hljs-number">169</span> <span class="hljs-comment"># &#x6700;&#x597D;&#x548C;&#x6570;&#x636E;&#x5E93;&#x5B58;&#x50A8;&#x7684;&#x4E00;&#x6837;</span>
<span class="hljs-comment"># &#x6B63;&#x8138;&#x5173;&#x952E;&#x70B9;</span>
Size_KeyPoints = {<span class="hljs-string">&apos;1&apos;</span>: [(<span class="hljs-number">112</span>, <span class="hljs-number">112</span>), np.array([(<span class="hljs-number">38.2946</span>, <span class="hljs-number">51.6963</span>),
                                              (<span class="hljs-number">73.5318</span>, <span class="hljs-number">51.6963</span>),
                                              (<span class="hljs-number">56.0252</span>, <span class="hljs-number">71.7366</span>),
                                              (<span class="hljs-number">41.5493</span>, <span class="hljs-number">92.3655</span>),
                                              (<span class="hljs-number">70.7299</span>, <span class="hljs-number">92.3655</span>)])]}
<span class="hljs-comment"># &#x4E0B;&#x8F7D;&#x597D;&#x7684;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;</span>
PreTrainModelDir = <span class="hljs-string">r&apos;E:\facenet_model\20180408-102900\20180408-102900.pb&apos;</span>
<span class="hljs-comment"># &#x9608;&#x503C;</span>
Threshold = <span class="hljs-number">0.6</span>  <span class="hljs-comment"># &#x8DDD;&#x79BB;&#x5C0F;&#x4E8E;&#x9608;&#x503C;&#x5C31;&#x89C6;&#x4E3A;&#x662F;&#x4E00;&#x4E2A;&#x4EBA;</span>

<span class="hljs-comment"># &#x964C;&#x751F;&#x4EBA;&#x6807;&#x6CE8;</span>
Strname = <span class="hljs-string">&apos;unKnown&apos;</span>

KN=<span class="hljs-string">&apos;1&apos;</span>

<span class="hljs-comment"># &#x5B9E;&#x65F6;&#x89C6;&#x9891;&#x7684;&#x8F93;&#x5165;&#x6587;&#x4EF6;</span>
CAPVideo = cv2.VideoCapture(<span class="hljs-number">0</span>, cv2.CAP_DSHOW)


<span class="hljs-comment"># &#x56FE;&#x7247;&#x6570;&#x636E;&#x6807;&#x6CE8;&#x51FD;&#x6570;</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_tip</span><span class="hljs-params">(figuredata, boxdata, txt, boxcolor=<span class="hljs-params">(<span class="hljs-number">220</span>, <span class="hljs-number">20</span>, <span class="hljs-number">20</span>)</span>, boxw=<span class="hljs-number">2</span>, txtcolor=<span class="hljs-params">(<span class="hljs-number">20</span>, <span class="hljs-number">220</span>, <span class="hljs-number">20</span>)</span>)</span>:</span>
    <span class="hljs-comment"># &#x6807;&#x6CE8;&#x4EBA;&#x8138;&#x6846;</span>
    box_data = cv2.rectangle(figuredata, boxdata[<span class="hljs-number">0</span>], boxdata[<span class="hljs-number">1</span>], boxcolor, boxw)
    <span class="hljs-comment"># &#x6DFB;&#x52A0;&#x6587;&#x5B57;</span>
    font = cv2.FONT_HERSHEY_COMPLEX
    x, y = boxdata[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>], boxdata[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]
    txt_data = cv2.putText(box_data, txt, (x, y), font, fontScale=<span class="hljs-number">0.6</span>, color=txtcolor, thickness=<span class="hljs-number">1</span>)
    <span class="hljs-keyword">return</span> txt_data


<span class="hljs-comment"># &#x89C6;&#x9891;&#x4EBA;&#x8138;&#x8BC6;&#x522B;</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">face_video_iden</span><span class="hljs-params">(fs=ImageSize,md=PreTrainModelDir, jp=JsonPath, tn=Threshold, keyn=KN,
                     rfs=Size_KeyPoints[KN][<span class="hljs-number">0</span>], dstdata=Size_KeyPoints[KN][<span class="hljs-number">1</span>], sn=Strname, cap=CAPVideo)</span>:</span>
    <span class="hljs-comment"># &#x83B7;&#x53D6;&#x6570;&#x636E;&#x5E93;&#x7F16;&#x7801;</span>
    <span class="hljs-keyword">with</span> open(jp, <span class="hljs-string">&apos;r&apos;</span>) <span class="hljs-keyword">as</span> g:
        json_str = g.read()
    face_code_dict = dict(json.loads(json_str))
    <span class="hljs-comment"># &#x4EBA;&#x8138;&#x68C0;&#x6D4B;&#x6A21;&#x578B;</span>
    detector = MTCNN()
    <span class="hljs-comment"># &#x4EBA;&#x8138;&#x7F16;&#x7801;&#x6A21;&#x578B;</span>
    sess = tf.Session()
    <span class="hljs-comment"># &#x4E0B;&#x8F7D;&#x9884;&#x8BAD;&#x7EC3;&#x6A21;&#x578B;&#x53C2;&#x6570;</span>
    facenet.load_model(md)
    <span class="hljs-comment"># &#x6839;&#x636E;&#x540D;&#x79F0;&#x83B7;&#x53D6;&#x76F8;&#x5E94;&#x7684;&#x5F20;&#x91CF;</span>
    image_input_tensor = tf.get_default_graph().get_tensor_by_name(<span class="hljs-string">&quot;input:0&quot;</span>)
    embeddings_tensor = tf.get_default_graph().get_tensor_by_name(<span class="hljs-string">&quot;embeddings:0&quot;</span>)
    phase_train_tensor = tf.get_default_graph().get_tensor_by_name(<span class="hljs-string">&quot;phase_train:0&quot;</span>)
    <span class="hljs-comment"># &#x5F00;&#x59CB;&#x904D;&#x5386;&#x6BCF;&#x4E2A;&#x56FE;&#x7247;</span>
    <span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:
        ret, image_data = cap.read()
        <span class="hljs-comment"># &#x8BFB;&#x53D6;&#x56FE;&#x7247;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x8F6C;&#x6362;&#x901A;&#x9053;</span>
        result_detection = detector.detect_faces(image_data)
        <span class="hljs-comment"># &#x5B58;&#x50A8;&#x8BC6;&#x522B;&#x5230;&#x7684;&#x4EBA;&#x8138;</span>
        face_set_signed = {}
        <span class="hljs-comment"># &#x6CA1;&#x6709;&#x8BC6;&#x522B;&#x5230;&#x7684;&#x4EBA;&#x8138;</span>
        fce_set_nosign = {}
        fce_set_nosign[sn] = []
        <span class="hljs-comment"># &#x5224;&#x65AD;&#x662F;&#x5426;&#x68C0;&#x6D4B;&#x51FA;&#x4EBA;&#x8138;</span>
        <span class="hljs-keyword">if</span> result_detection:
            <span class="hljs-comment"># &#x904D;&#x5386;&#x83B7;&#x53D6;&#x5230;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x8138;</span>
            <span class="hljs-keyword">for</span> face <span class="hljs-keyword">in</span> result_detection:
                <span class="hljs-comment"># &#x83B7;&#x53D6;&#x6846;&#x7684;&#x50CF;&#x7D20;&#x5750;&#x6807;</span>
                minx, miny, width, height = face[<span class="hljs-string">&apos;box&apos;</span>]
                maxx, maxy = minx + width, miny + height
                <span class="hljs-comment"># &#x5C06;&#x68C0;&#x6D4B;&#x5230;&#x7684;&#x4EBA;&#x8138;&#x56FE;&#x7247;&#x622A;&#x53D6;&#x4E0B;&#x6765;</span>
                face_detection_data = image_data[miny:maxy, minx:maxx, :]
                face_detection_data = cv2.cvtColor(face_detection_data, cv2.COLOR_RGB2BGR)
                <span class="hljs-comment"># &#x83B7;&#x5F97;&#x4E94;&#x4E2A;&#x5173;&#x952E;&#x70B9;&#x7684;&#x5750;&#x6807;</span>
                src_data = []
                <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> [<span class="hljs-string">&apos;left_eye&apos;</span>, <span class="hljs-string">&apos;right_eye&apos;</span>, <span class="hljs-string">&apos;nose&apos;</span>, <span class="hljs-string">&apos;mouth_left&apos;</span>, <span class="hljs-string">&apos;mouth_right&apos;</span>]:
                    src_data.append(face[<span class="hljs-string">&apos;keypoints&apos;</span>][k])
                <span class="hljs-comment"># &#x8BA1;&#x7B97;&#x4EFF;&#x5C04;&#x77E9;&#x9635;</span>
                tform = trans.SimilarityTransform()
                res = tform.estimate(np.array(src_data), dstdata)
                M = tform.params
                <span class="hljs-comment"># &#x5E94;&#x7528;&#x4EFF;&#x5C04;&#x77E9;&#x9635;&#x8FDB;&#x884C;&#x4EBA;&#x8138;&#x5BF9;&#x9F50;</span>
                align_face_data = cv2.warpAffine(image_data.copy(), M[:<span class="hljs-number">2</span>, :], rfs,
                                                 flags=cv2.INTER_CUBIC, borderValue=(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>))
                <span class="hljs-comment"># &#x8FDB;&#x5165;&#x4EBA;&#x8138;&#x7F16;&#x7801;&#x6A21;&#x578B;</span>
                code_face_data = cv2.resize(align_face_data, (fs, fs), interpolation=cv2.INTER_CUBIC)
                <span class="hljs-comment"># &#x56FE;&#x7247;&#x6570;&#x636E;&#x9884;&#x5904;&#x7406;</span>
                code_face_data = facenet.prewhiten(code_face_data)
                <span class="hljs-comment"># &#x6570;&#x636E;&#x589E;&#x52A0;&#x7EF4;&#x5EA6;</span>
                code_face_data = code_face_data.reshape(<span class="hljs-number">-1</span>, fs, fs, <span class="hljs-number">3</span>)
                <span class="hljs-comment"># &#x7F16;&#x7801;&#x6570;&#x636E;&#xFF0C;&#x957F;&#x5EA6;&#x4E3A;512</span>
                embeddings_data = sess.run(embeddings_tensor,
                                           feed_dict={image_input_tensor: code_face_data,
                                                      phase_train_tensor: <span class="hljs-keyword">False</span>})[<span class="hljs-number">0</span>].tolist()
                <span class="hljs-comment"># &#x5F00;&#x59CB;&#x904D;&#x5386;&#x6570;&#x636E;&#x5E93;&#x7F16;&#x7801;</span>
                person_dict = {}
                <span class="hljs-keyword">for</span> person <span class="hljs-keyword">in</span> face_code_dict:
                    code_list = face_code_dict[person][str(fs)][keyn]
                    all_dis = []
                    <span class="hljs-keyword">for</span> pco <span class="hljs-keyword">in</span> code_list:
                        all_dis.append(cde.compare_dis_em(embeddings_data, pco))
                    <span class="hljs-comment"># &#x8BA1;&#x7B97;&#x5747;&#x503C;</span>
                    person_dict[person] = sum(all_dis) / len(code_list)
                <span class="hljs-comment"># &#x6240;&#x6709;&#x7684;&#x5747;&#x503C;&#x90FD;&#x4E0D;&#x5C0F;&#x4E8E;&#x9608;&#x503C;&#xFF0C;&#x5219;&#x4E3A;&#x964C;&#x751F;&#x4EBA;&#xFF0C;&#x5426;&#x5219;&#x9009;&#x62E9;&#x6700;&#x5C0F;&#x7684;&#x4F5C;&#x4E3A;&#x8EAB;&#x4EFD;</span>
                min_dis = sorted(person_dict.items(), key=<span class="hljs-keyword">lambda</span> s:s[<span class="hljs-number">1</span>])[<span class="hljs-number">0</span>]
                print(min_dis)
                <span class="hljs-keyword">if</span> min_dis[<span class="hljs-number">1</span>] &gt; tn:
                    <span class="hljs-comment"># &#x964C;&#x751F;&#x4EBA;</span>
                    fce_set_nosign[sn].append([(minx, miny), (maxx, maxy)])
                <span class="hljs-keyword">else</span>:
                    face_set_signed[min_dis[<span class="hljs-number">0</span>]] = [(minx, miny), (maxx, maxy)]
        <span class="hljs-comment"># &#x5F00;&#x59CB;&#x8FDB;&#x884C;&#x6807;&#x6CE8;</span>
        image_data = cv2.cvtColor(image_data, cv2.COLOR_RGB2BGR)
        <span class="hljs-keyword">if</span> fce_set_nosign[sn]:
            <span class="hljs-keyword">for</span> data_f <span class="hljs-keyword">in</span> fce_set_nosign[sn]:
                image_data = plot_tip(image_data, data_f, sn)
        <span class="hljs-keyword">if</span> face_set_signed:
            <span class="hljs-keyword">for</span> fkey <span class="hljs-keyword">in</span> face_set_signed:
                image_data = plot_tip(image_data, face_set_signed[fkey], fkey)
        <span class="hljs-comment"># &#x4FDD;&#x5B58;&#x4E3A;&#x56FE;&#x7247;</span>
        image_data = cv2.cvtColor(image_data, cv2.COLOR_RGB2BGR)
        cv2.imshow(<span class="hljs-string">&apos;object detection&apos;</span>, image_data)
        <span class="hljs-keyword">if</span> cv2.waitKey(<span class="hljs-number">25</span>) &amp; <span class="hljs-number">0xFF</span> == ord(<span class="hljs-string">&apos;q&apos;</span>):
            cv2.destroyAllWindows()
            <span class="hljs-keyword">break</span>
    cap.release()
    cv2.destroyAllWindows()


face_video_iden()
</code></pre>
<p>&#x793A;&#x56FE;&#xFF1A;</p>
<p><img src="figure/5.15.png" alt=""></p>
<p><img src="figure/5.16.png" alt=""></p>
<p><img src="figure/5.17.png" alt=""></p>
<p><img src="figure/5.18.png" alt=""> </p>
<footer class="page-footer"><span class="copyright">Copyright &#xA9; AnFany 2020 all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">&#x6700;&#x8FD1;&#x4FEE;&#x8BA2;&#x65F6;&#x95F4;&#xFF1A;
2021-01-04 11:17:06
</span></footer>
<script>console.log("plugin-popup....");document.onclick = function(e){ e.target.tagName === "IMG" && window.open(e.target.src,e.target.src)}</script><style>img{cursor:pointer}</style>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="chapter4.html#46-模型预测" class="navigation navigation-prev " aria-label="Previous page: 4.6 模型预测">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="chapter5.html#51-mtcnn" class="navigation navigation-next " aria-label="Next page: 5.1 MTCNN">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"5 人脸识别模型","level":"1.6","depth":1,"next":{"title":"5.1 MTCNN","level":"1.6.1","depth":2,"anchor":"#51-mtcnn","path":"chapter5.md","ref":"chapter5.md#51-mtcnn","articles":[{"title":"5.1.1 人脸检测","level":"1.6.1.1","depth":3,"anchor":"#511-人脸检测","path":"chapter5.md","ref":"chapter5.md#511-人脸检测","articles":[]},{"title":"5.1.2 人脸对齐","level":"1.6.1.2","depth":3,"anchor":"#512-人脸对齐","path":"chapter5.md","ref":"chapter5.md#512-人脸对齐","articles":[]}]},"previous":{"title":"4.6 模型预测","level":"1.5.6","depth":2,"anchor":"#46-模型预测","path":"chapter4.md","ref":"chapter4.md#46-模型预测","articles":[]},"dir":"ltr"},"config":{"plugins":["anchors","tbfed-pagefooter","donate","chapter-fold","splitter","back-to-top-button","github@2.0.0","hide-element","code","-sharing","sharing-plus","auto-scroll-table","pageview-count","popup","livereload"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright &copy AnFany 2020","modify_label":"最近修订时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"chapter-fold":{},"github":{"url":"https://github.com/Anfany"},"livereload":{},"splitter":{},"search":{},"sharing-plus":{"qq":false,"all":["facebook","google","twitter","instapaper","linkedin","pocket","stumbleupon"],"douban":false,"facebook":true,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":true,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"auto-scroll-table":{},"popup":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"code":{"copyButtons":true},"donate":{"alipay":"figure/0.0.jpg","alipayText":"支付宝赞助","button":"神来之笔","title":"","wechat":"figure/0.1.jpg","wechatText":"微信赞助"},"hide-element":{"elements":[".gitbook-link"]},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"back-to-top-button":{},"pageview-count":{},"sharing":{"qq":false,"all":["douban","facebook","google","linkedin","twitter","qq","weibo","whatsapp"],"douban":false,"facebook":false,"weibo":false,"whatsapp":false,"twitter":false,"google":false,"linkedin":false},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchors":{}},"theme":"default","author":"AnFany","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Machine Vision CookBook with TensorFlow2","language":"zh-hans","gitbook":"*"},"file":{"path":"chapter5.md","mtime":"2021-01-04T03:17:06.615Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-01-04T03:47:56.624Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-donate/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-chapter-fold/chapter-fold.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-hide-element/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing-plus/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-auto-scroll-table/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-pageview-count/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

